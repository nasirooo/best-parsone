if (self.CavalryLogger) { CavalryLogger.start_js(["3xo8Y"]); }

__d("MessengerDeltaTransformer.bs",["Promise","FBID.bs","bs_block","bs_curry","gkx","bs_js_dict","bs_js_json","bs_caml_obj","FBIDCheck","bs_belt_Array","bs_caml_array","DateConsts","LogHistory","MercuryIDs","bs_belt_Option","bs_caml_option","requireCond","MessagingTag","MessengerState.bs","MontageActions","bs_js_null_undefined","MercuryActionType","MercuryDispatcher","MessengerWebEvent","MSuggestionActions","MercuryThreadIDMap","PageCommItemStatus","MercuryPayloadSource","MercuryProfileRanges","MercuryLogMessageType","MercuryServerRequests","MercurySyncDeltaTypes","MessagingThreadAction","MessageThreadReadState","MessengerThreadFetcher.bs","bs_caml_builtin_exceptions","MercuryGlobalActionType","MessengerWebDeltaEvents","PagesMessagingEventType","MessengerGroupsSyncStatus","MessengerGroupsSyncStatus.bs","MessageUnsendabilityStatus.bs","MessengerApprovalModeTypes","MessengerMessageDFFFetcher.bs","IrisProtocolMessageLifetime","MessengerApprovalQueueTypes","MessengerGroupRequestSource","MercuryMessageCustomizations","MessageThreadReadStateEffect","MessengerParticipantsFetcher.bs","MessengerWebDeltasTypedLogger","ChatReliabilityInstrumentation","MessengerWebStgTypedLoggerLite","RepliedToMessageStatusForGraphQL","ClientSyncProtocol_GroupsSyncAction","MessengerRealtimeAttachmentTransformer.bs","MessengerWebDeltasTypedLoggerBootloader.bs","MessageLiveLocationClientSyncProtocolStopReason","cr:1299779"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){try{return JSON.parse(a)}catch(a){return{}}}c=b("gkx")("780647");var h=c?0:1;function i(a,c){__p&&__p();var d=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.otherUserFbId),function(a){return a.toString()});c=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.threadFbId),function(a){return a.toString()});a=b("MercuryThreadIDMap").getForFBID(a);if(d!==void 0){d=d;d=[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("FBID.bs").ofStringExn(d))),d]}else if(c!==void 0){c=c;d=[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c))),c]}else d=[void 0,void 0];c=d[1];d=d[0];if(c!==void 0&&d!==void 0){c=c;var e=a.hasClientIDForServerID(c);if(e)return b("bs_caml_option").nullable_to_opt(a.getClientIDFromServerIDNow(c));else return b("bs_caml_option").valFromOption(d)}}function j(a,b,c,d){if(a==null)if(b==null)return[void 0,void 0];else{d=c.toString()!==d;d=d?c:b;return[d.toString(),{otherUserFbId:d,threadFbId:null}]}else return[a.toString(),{otherUserFbId:null,threadFbId:a}]}function k(a,c){__p&&__p();var d=parseInt(c.messageMetadata.timestamp,10),e=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta(a,c),f=c.messageMetadata.actorFbId.toString(),h=b("bs_caml_obj").caml_equal(e,b("MessageThreadReadState").MARK_UNREAD)&&a!==f,j=!b("FBIDCheck").isUser_deprecated(a),k=c.attachments;k=k==null?[]:b("bs_belt_Array").keepMapU(k,function(e){__p&&__p();var c=e.mercury;if(c==null){e=e.mercuryJSON;e=e==null?null:g(e)}else e=c;if(e==null)return;else{c=e.extensible_attachment;var d=e.blob_attachment;e=e.sticker_attachment;e=c==null?d==null?e==null?[]:b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:null,sticker:e},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:[d],sticker:null},j):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:b("bs_js_null_undefined").fromOption(c==null?void 0:b("bs_caml_option").some(c)),blob_attachments:null,sticker:null},j);return b("bs_belt_Array").get(e,0)}});var l=c.messageMetadata.tags;l=l==null?void 0:b("bs_js_null_undefined").fromOption(b("bs_belt_Array").get(l,0));var m=c.data,n;if(m==null)n=null;else{var o=b("bs_js_dict").get(m,"adminSignatureCreatorID");n=o!==void 0?{creatorID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorID")),creatorName:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorName")),creatorType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureCreatorType")),labelType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureLabelType")),pageID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignaturePageID")),profileURI:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(m,"adminSignatureProfileURI"))}:null}o=i(a,c.messageMetadata.threadKey);if(o!==void 0){m=c.ttl;var p=c.messageMetadata.threadKey.threadFbId,q=c.messageMetadata.threadKey.otherUserFbId,r=c.body,s=c.data;if(s==null){var t=c.untypedData;t=t==null?!1:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(t,"is_sponsored"),"false")==="true"}else t=b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(s,"is_sponsored"),"false")==="true";s=c.data;var u=c.data,v;if(u==null)v=null;else{u=b("bs_js_dict").get(u,"customization");v=u!==void 0?b("MercuryMessageCustomizations").parseCustomizations(u):null}u=c.data;var w=c.data,x=c.data,y;if(x==null)y=null;else{x=b("bs_js_dict").get(x,"mib_direct_message_data");y=x!==void 0?g(x):null}x=c.data;var z;if(x==null)z=null;else{x=b("bs_js_dict").get(x,"message_source_data");if(x!==void 0){x=g(x);x=b("bs_js_json").classify(x);if(typeof x==="number"||x.tag!==2)z=null;else{x=b("bs_js_dict").get(x[0],"message_source");z=x!==void 0?b("bs_js_null_undefined").fromOption(x):null}}else z=null}x=c.messageMetadata.skipBumpThread;var A=c.data,B;if(A==null)B=null;else{A=b("bs_js_dict").get(A,"montage_reply_data");B=A!==void 0?g(A):null}A=c.data;var C;if(A==null)C=null;else{A=b("bs_js_dict").get(A,"meta_ranges");C=A!==void 0?g(A):null}return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(f)),author_email:f+"@facebook.com",ephemeral_ttl_mode:m==null?0:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(b("IrisProtocolMessageLifetime"),m),0),timestamp:d,is_unread:h,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_one_way_sent:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){return a===b("MessagingTag").ONE_WAY_MESSAGE}),is_forwarded:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){if(a===b("MessagingTag").ACTION_COPIED_MESSAGE||a===b("MessagingTag").ACTION_COPIED_SELF_MESSAGE||a===b("MessagingTag").ACTION_COPIED_ATTACHMENT)return!0;else return a===b("MessagingTag").ACTION_COPIED_SELF_ATTACHMENT}),source:l,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:null,thread_fbid:p==null?null:p.toString(),other_user_fbid:q==null?null:q.toString(),body:r==null?"":r,html_body:null,subject:null,has_attachment:k.length!==0,attachments:k,ranges:void 0,thread_id:o,action_type:b("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:!0,is_sponsored:t,commerce_message_type:s==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(s,"commerce_message_type")),customizations:v,platform_xmd:u==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(u,"platform_xmd")),profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),verse_group_role_xmd:w==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(w,"verse_group_role_id")),mib_direct_message_data:y,message_source:z,skip_bump_thread:x==null?!1:x,thread_read_state_effect:e,montage_reply_data:B,meta_ranges:C,creator_info:n,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.messageMetadata.unsendType),comm_status:j?b("PageCommItemStatus").TODO:null}}else throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"]}function l(a,c){b("LogHistory").getInstance("MessengerDeltaTransformer").debug(a,c);return 0}function m(a,c,d,e){return b("bs_curry")._1(b("MessengerWebDeltasTypedLoggerBootloader.bs").LoadableMessengerWebDeltasTypedLogger.load,function(f){f=new(b("MessengerWebDeltasTypedLogger"))();f=f.setDeltaEvent(a).setDeltaType(c).setIgnoreReason(d).setSyncSeqID(e);f.log();return 0})}function n(a){return m(b("MessengerWebDeltaEvents").DELTA_RECEIVED,a,null,null)}function o(a,c){m(b("MessengerWebDeltaEvents").DELTA_IGNORED,a,c,null);return l("DeltaIgnored",a)}function p(a,c,d,e,f){return b("MessengerThreadFetcher.bs").$$fetch(a,c,d,function(c){if(c){b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[e],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return n(f)}else return o(f,"thread fetch failed")})}function q(a,c,d,e){__p&&__p();var f=c.other_user_fbid;if(f==null){var g=c.thread_fbid;if(g==null)throw[b("bs_caml_builtin_exceptions").invalid_argument,"invalid thread id"];else g=[g,!1]}else g=[f,!0];f=g[1];g=g[0];var h=b("MercuryThreadIDMap").getForFBID(a);h=h.getClientIDFromServerIDNow(g);var i=h==null?null:b("MessengerState.bs").getThreadMetaNow(a,h),j=b("gkx")("1143875");if(h==null)if(e)return p(a,g,f,c,d);else return o(d,"thread not already loaded, not required to be loaded");else if(i==null)if(e){if(j){p(a,g,f,c,d);l("ThreadMetaMissing",g);b("ChatReliabilityInstrumentation").logTHREAD_INFO_MISSING(b("LogHistory").formatEntries(b("LogHistory").getEntries()));return 0}else if(j)return o(d,"thread not already loaded, not required to be loaded")}else if(j)return o(d,"thread not already loaded, not required to be loaded");b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[c],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return n(d)}function r(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").REACTION_UPDATE,messageId:c.messageId,offlineThreadingId:c.offlineThreadingId,reaction:c.reaction,senderId:c.senderId.toString(),thread_fbid:e.toString(),other_user_fbid:null,userId:c.userId.toString()};else return}}function s(a){return a/Math.pow(10,8)}function t(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d),f=c.threadKey.otherUserFbId,g=f==null?void 0:b("bs_caml_option").some(f);d=d==null?f==null?[void 0,void 0]:[g,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(g)}]:[e,{otherUserFbId:b("bs_js_null_undefined").fromOption(e),threadFbId:null}];f=d[1];g=d[0];if(g!==void 0&&f!==void 0){e=i(a,b("bs_caml_option").valFromOption(f));if(e!==void 0&&c.messageLiveLocations.length===1){d=b("bs_caml_array").caml_array_get(c.messageLiveLocations,0);a=d.expirationTime;f=d.stopReason;c=f==null?Date.now()/b("DateConsts").MS_PER_SEC>a:!0;f=d.coordinate;f=f==null?null:{latitude:s(f.latitude),longitude:s(f.longitude)};var h=d.destination;h=h==null?null:{latitude:s(h.latitude),longitude:s(h.longitude),label:h.label};var j=d.stopReason;j=j==null?null:j===b("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED||j===b("MessageLiveLocationClientSyncProtocolStopReason").CANCELED?"EXPIRED":j===b("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED?"ARRIVED":null;return{thread_id:e,action_type:b("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:g.toString(),other_user_fbid:null,messageId:d.messageId,liveLocation:{live_location_id:d.id.toString(),is_expired:c,expiration_time:a,sender:{id:d.senderId.toString()},coordinate:f,location_title:d.locationTitle,sender_destination:h,stop_reason:j}}}else return}}function u(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").EVENT_RSVP_CHANGED,actor_fbid:c.actorFbId.toString(),rsvp_status:c.rsvpStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function v(a,c){__p&&__p();var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0){c=c.isFollowUp;return{action_type:b("MercuryActionType").UPDATE_COMM_STATUS,comm_status:c?b("PageCommItemStatus").FOLLOW_UP:b("PageCommItemStatus").TODO,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}else return}}function w(a,c){__p&&__p();var d=[];c.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(a==null)return 0;else{d.push(a);return 0}});return b("MessengerParticipantsFetcher.bs").$$fetch({ids:d}).then(function(c){__p&&__p();var d=[],e=[];c.forEach(function(a){var b=a.id;if(a.is_messenger_blocked||a.is_facebook_blocked){d.push(b);return 0}else{e.push(b);return 0}});b("MercuryDispatcher").getForFBID(a).handleUpdate({from_client:!0,message_blocked_ids:d,message_unblocked_ids:e});return b("Promise").resolve(0)})["catch"](function(a){return b("Promise").resolve(0)})}function x(a,c){__p&&__p();var d=c.actorFbid.toString(),e=b("FBID.bs").ofStringExn(d);if(b("bs_caml_obj").caml_notequal(e,a))e=b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(a));else{var f=c.threadKey.otherUserFbId;if(f==null)e=void 0;else{f=b("FBID.bs").ofString(f.toString());e=f!==void 0?b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(f))):void 0}}if(e!==void 0){f=b("bs_caml_option").valFromOption(e);e=c.threadKey.otherUserFbId;if(e==null)return;else{w(a,[f]);a=i(a,{otherUserFbId:e,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:d,canViewerReply:c.canViewerReply,reason:c.reason,message_blocked_ids:[f],other_user_fbid:e.toString(),thread_fbid:null,thread_id:a};else return}}}function y(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:c.messageId,timestamp:c.timestamp,thread_fbid:e,other_user_fbid:null,keep_expiry_timestamp:c.keepExpiryTimestamp,thread_id:a};else return}}function z(a,c){__p&&__p();var d=k(a,c.message),e=c.repliedToMessage;if(e==null)return b("bs_caml_option").some(d);else{a=k(a,e);e=c.status;var f;if(e==null)f=void 0;else switch(e){case 0:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").VALID);break;case 1:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").DELETED);break;case 2:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").TEMPORARILY_UNAVAILABLE);break;default:f=void 0}if(f!==void 0)return b("bs_caml_option").some(Object.assign(d,{replied_to_message:{status:b("bs_caml_option").valFromOption(f),message:a}}));else return}}function A(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{action_type:b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_status_string:b("MessengerGroupsSyncStatus.bs").fromNullableString(c.groupsSyncStatus),thread_id:d};else return}}function B(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];d=c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_IN?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_IN):c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_OUT?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_OUT):void 0;if(e!==void 0&&d!==void 0&&f!==void 0){a=i(a,b("bs_caml_option").valFromOption(f));if(a!==void 0){f=c.syncedFbGroupId;return{action_type:b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_action:b("bs_caml_option").valFromOption(d),source_surface:c.sourceSurface,fb_group_id:f==null?null:f.toString(),thread_id:a,emoji_codepoints:c.emojiCodePoints}}else return}}function C(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").DESCRIPTION_CHANGED,thread_fbid:d.toString(),other_user_fbid:null,group_thread_description_string:c.threadDescription,thread_id:a};else return}}function D(a){return"#"+a.slice(2)}function E(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e!==void 0&&f!==void 0){d=e;e=i(a,b("bs_caml_option").valFromOption(f));if(e!==void 0){a=e;f=c.fallbackColor!==""?D(c.fallbackColor):"";e=c.reactionPack;var g;if(e==null)g=[void 0,void 0];else{var h=e.reactionAssets;e=e.fontAsset;g=[h==null?void 0:h.map(function(a){return{reactionName:a.reactionName,reactionEmoji:a.reactionEmoji,keyframeAssetUri:a.keyframeAssetUri}}),e==null?void 0:e.assetUri]}h=g[1];e=g[0];g=c.gradientColors;if(!(g==null)&&g.length!==0){g=b("bs_belt_Array").map(g,D);return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId.toString(),solid_color:f,header_color:b("bs_caml_array").caml_array_get(g,0),footer_color:b("bs_caml_array").caml_array_get(g,g.length-1|0),gradient_colors:g,thread_id:a,reactions:e,reactionFont:h}}return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),other_user_fbid:null,theme_id:c.themeId.toString(),solid_color:f,header_color:f,footer_color:f,gradient_colors:[],thread_id:a,reactions:e,reactionFont:h}}else return}}function F(a,c,d,e,f,g){var i=d.threadFbId===null;d=d.otherUserFbId===null;i={action_type:b("MercuryActionType").PIN_MESSAGE,thread_fbid:i?null:c,other_user_fbid:d?null:c,thread_id:e,actor_fbid:f.actorFbid.toString(),pin_message_action:{message:{message_id:f.pinnedMessage.pinnedMessageId,pinning_time:f.pinnedMessage.timestamp,message:g}}};return q(a,i,"DeltaClientDelta.deltaUpdatePinnedMessage",h)}function G(a,c,d){__p&&__p();var e=j(c.threadKey.threadFbId,c.threadKey.otherUserFbId,c.actorFbid,a),f=e[1];e=e[0];if(e!==void 0&&f!==void 0){var g=b("bs_caml_option").valFromOption(f),h=e;f=i(a,g);if(f!==void 0){var k=f;e=c.pinnedMessage.pinnedMessageId;f=b("MessengerState.bs").getMessageFromID(a,e);if(f!==void 0)return F(a,h,g,k,c,b("bs_caml_option").valFromOption(f));else{b("MessengerMessageDFFFetcher.bs").fetch_(a,{message_id:e,thread_id:h},!1).then(function(d){F(a,h,g,k,c,d);return b("Promise").resolve(0)})["catch"](function(a){d[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedMessage","error on fetching pinned message payload"]);return b("Promise").resolve(0)});return 0}}else{d[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedMessage","transform failed"]);return 0}}else{d[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedMessage","transform failed"]);return 0}}function H(a,c){__p&&__p();var d=j(c.threadKey.threadFbId,c.threadKey.otherUserFbId,c.actorFbid,a),e=d[1];d=d[0];if(d!==void 0&&e!==void 0){e=b("bs_caml_option").valFromOption(e);d=d;a=i(a,e);if(a!==void 0){var f=e.threadFbId===null;e=e.otherUserFbId===null;return{action_type:b("MercuryActionType").UNPIN_MESSAGE,thread_fbid:f?null:d,other_user_fbid:e?null:d,thread_id:a,unpin_message_action:{message_id:c.pinnedMessage.pinnedMessageId},actor_fbid:c.actorFbid.toString()}}else return}}function I(a,c){__p&&__p();var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").CHANGE_PINNED_STATUS,thread_fbid:e,other_user_fbid:null,is_pinned:c.isPinned,thread_id:a,thread_pin_timestamp:c.timestamp};else return}}function J(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;e=d==null?e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]:[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e!==void 0&&d!==void 0){a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0){d=c.isSaved;var f=c.isSaved;return{action_type:b("MercuryActionType").MUTATE_TAGS,thread_fbid:e,other_user_fbid:null,thread_id:a,messageId:c.messageId,tags_to_add:d?["message:save"]:[],tags_to_delete:f?[]:["message:save"]}}else return}}function K(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_JOINABLE_LINK,joinable_link:c.privateGroupLink,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function L(a){__p&&__p();a=a.directives;if(a==null)return;else{a=b("bs_belt_Array").get(a,0);if(a!==void 0){a=b("bs_caml_option").valFromOption(a).data;if(a==null)return;else{a=a.add_actions;if(a==null)return;else{var c=a.actions;if(c==null)return;else{c=b("bs_belt_Array").get(c,0);if(c!==void 0){c=b("bs_caml_option").valFromOption(c).thread_key;if(c==null)return;else{var d=c.thread_fbid;c=c.other_user_fbid;if(d==null)if(c==null)return;else c=c;else c=d;return{action_type:b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS,thread_fbid:b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c)),other_user_fbid:null,thread_id:c,suggestions:a}}}else return}}}}else return}}function M(a,c){var d=c.threadKey.threadFbId;if(d==null)return;else{a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").PROMOTE_GROUP_ADMINS,thread_fbid:d.toString(),other_user_fbid:null,promoted_admins:b("bs_belt_Array").map(c.promotedAdmins,function(a){return{admin_fbid:a.adminFbId.toString(),admin_type:a.adminType}}),thread_id:a};else return}}function N(a,c){__p&&__p();var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;if(d==null)if(e==null)return;else{var f=i(a,{otherUserFbId:e,threadFbId:null});if(f!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:null,messageId:c.messageID,other_user_fbid:e.toString(),removed_timestamp:c.deletionTimestamp,thread_id:f,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)};else return}else{e=i(a,{otherUserFbId:null,threadFbId:d});if(e!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:d.toString(),messageId:c.messageID,other_user_fbid:null,removed_timestamp:c.deletionTimestamp,thread_id:e,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)};else return}}function O(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE,page_unsubscribe_status:c.unSubscribeStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function P(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLURRED_IMAGE_STATUS,blurred_image_uri:c.blurredImageUri,image_message_id:c.messageId,image_id:c.imageId,should_show:c.shouldShow,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a};else return}}function Q(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:d.toString(),other_user_fbid:null,is_pin_protected:c.isPinProtected,thread_id:a};else return}}function R(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;else{a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS,other_user_fbid:d.toString(),subtitle_type:c.subtitleType,thread_connectivity_status:c.threadConnectivityStatus,thread_fbid:d.toString(),thread_id:a};else return}}var S=function(a){return String.fromCharCode.apply(null,a)};function T(a,c){__p&&__p();c=JSON.parse(S(c.payload));c=b("bs_js_json").classify(c);if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","malformed payload"]);else{c=b("bs_js_dict").get(c[0],"deltas");if(c!==void 0){c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number"||c.tag!==3)return b("bs_block").__(1,["DeltaClientDelta","delta is not an array"]);else{c=b("bs_belt_Array").get(c[0],0);if(c!==void 0){c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number"||c.tag!==2)return b("bs_block").__(1,["DeltaClientDelta","client delta is not an object"]);else{c=c[0];var d=!1,e=[0],f=b("bs_js_dict").get(c,"deltaMessageReaction");if(f!==void 0){d=!0;f=r(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReaction",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReaction","transform failed"])}f=b("bs_js_dict").get(c,"liveLocationData");if(f!==void 0&&!d){d=!0;f=t(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.liveLocationData",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.liveLocationData","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupEventRSVPStatus");if(f!==void 0&&!d){d=!0;f=u(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupEventRSVPStatus",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupEventRSVPStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaPageThreadFollowUpData");if(f!==void 0&&!d){d=!0;f=v(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageThreadFollowUpData",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaPageThreadFollowUpData","transform failed"])}f=b("bs_js_dict").get(c,"deltaChangeViewerStatus");if(f!==void 0&&!d){d=!0;f=x(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaChangeViewerStatus",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaChangeViewerStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaMontageDirectExpire");if(f!==void 0&&!d){d=!0;f=y(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMontageDirectExpire",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaMontageDirectExpire","transform failed"])}f=b("bs_js_dict").get(c,"deltaMessageReply");if(f!==void 0&&!d){d=!0;f=z(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReply",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaMessageReply","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncStatus");if(f!==void 0&&!d){d=!0;f=A(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncStatus",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncStatus","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncMetadata");if(f!==void 0&&!d){d=!0;f=B(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncMetadata",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateGroupsSyncMetadata","transform failed"])}f=b("bs_js_dict").get(c,"deltaGroupThreadDescription");if(f!==void 0&&!d){d=!0;f=C(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaGroupThreadDescription",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaGroupThreadDescription","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateThreadTheme");if(f!==void 0&&!d){d=!0;f=E(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateThreadTheme",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateThreadTheme","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdateSavedMessage");if(f!==void 0&&!d){d=!0;f=J(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateSavedMessage",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdateSavedMessage","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdatePinnedThread");if(f!==void 0&&!d){d=!0;f=I(a,b("bs_caml_option").valFromOption(f));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePinnedThread",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedThread","transform failed"])}f=b("bs_js_dict").get(c,"deltaUpdatePinnedMessage");if(f!==void 0&&!d){f=b("bs_caml_option").valFromOption(f);d=!0;var g=f.pinnedMessageAction===0;if(g)G(a,f,e);else{g=H(a,f);g!==void 0?q(a,b("bs_caml_option").valFromOption(g),"DeltaClientDelta.deltaUpdatePinnedMessage",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePinnedMessage","transform failed"])}}f=b("bs_js_dict").get(c,"deltaUpdatePrivateGroupJoinableLink");if(f!==void 0&&!d){d=!0;g=K(a,b("bs_caml_option").valFromOption(f));g!==void 0?q(a,b("bs_caml_option").valFromOption(g),"DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink","transform failed"])}f=b("bs_js_dict").get(c,"deltaOmniMDirectivesV2");if(f!==void 0&&!d){d=!0;g=L(b("bs_caml_option").valFromOption(f));if(g!==void 0){f=b("bs_caml_option").valFromOption(g);e[0]=b("bs_block").__(0,["DeltaClientDelta.deltaOmniMDirectivesV2"]);b("MSuggestionActions").saveAllSuggestions(f.thread_id,f.suggestions)}else e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaOmniMDirectivesV2","transform failed"])}g=b("bs_js_dict").get(c,"deltaPromoteGroupThreadAdmin");if(g!==void 0&&!d){d=!0;f=M(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPromoteGroupThreadAdmin",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaPromoteGroupThreadAdmin","transform failed"])}g=b("bs_js_dict").get(c,"deltaRecallMessageData");if(g!==void 0&&!d){d=!0;f=N(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaRecallMessageData",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaRecallMessageData","transform failed"])}g=b("bs_js_dict").get(c,"deltaPageUnSubscribeStatus");if(g!==void 0&&!d){d=!0;f=O(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageUnSubscribeStatus",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaPageUnSubscribeStatus","transform failed"])}g=b("bs_js_dict").get(c,"deltaPageBlurredImageStatus");if(g!==void 0&&!d){d=!0;f=P(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageBlurredImageStatus",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaPageBlurredImageStatus","transform failed"])}g=b("bs_js_dict").get(c,"deltaPaymentPinProtectionStatusData");if(g!==void 0){if(!d){d=!0;f=Q(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPaymentPinProtectionStatusData",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaPaymentPinProtectionStatusData","transform failed"])}}else d||(e[0]=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join(",")]));g=b("bs_js_dict").get(c,"deltaThreadConnectivityStatusUpdate");if(g!==void 0){if(!d){d=!0;f=R(a,b("bs_caml_option").valFromOption(g));f!==void 0?q(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaThreadConnectivityStatusUpdateData",h):e[0]=b("bs_block").__(1,["DeltaClientDelta.deltaThreadConnectivityStatusUpdateData","transform failed"])}}else d||(e[0]=b("bs_block").__(1,["DeltaClientDelta","unknown delta type: "+Object.keys(c).join(",")]));return e[0]}}else return b("bs_block").__(1,["DeltaClientDelta","client delta is missing"])}}else return b("bs_block").__(1,["DeltaClientDelta","client delta has no deltas"])}}function U(a,c){__p&&__p();var d=[],e=[],f=c.folders,g=0;f==null||f.length===0?g=1:b("bs_belt_Array").forEachU(f,function(a){d.push({action_type:b("MercuryGlobalActionType").MARK_ALL_READ,action_id:null,folder:b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,a),timestamp:parseInt(c.watermarkTimestamp,10)});return 0});g===1&&b("bs_belt_Array").forEachU(c.threadKeys,function(f){var d=i(a,f);if(d!==void 0){var g=parseInt(c.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(g);e.push({thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:f.otherUserFbId,thread_fbid:f.threadFbId,mark_as_read:!0,timestamp:g,folder:b("MessagingTag").INBOX});return 0}else return 0});return[d,e]}function V(a){if(a==null)return null;else return a.toString()}function W(a){a=a.skipBumpThread;if(!(a==null)&&a)return h;else return 1}function X(a,c,d){if(b("cr:1299779")==null)return 0;else{var e=b("MercuryIDs").getThreadFBIDFromThreadID(a),f=b("MercuryIDs").isCanonical(a);a=b("MercuryIDs").isGroupChat(a);b("MessengerWebStgTypedLoggerLite").log({event_name:b("MessengerWebEvent").DELIVERY_RECEIPT,other_user_fbid:f?e:null,thread_fbid:a?e:null,extra_data:{message_ids:c,timestamp:d}});return 0}}function Y(a,c){__p&&__p();var d;switch(c.tag|0){case 0:var e=c[0],f=k(a,e);q(a,f,"deltaNewMessage",W(e.messageMetadata));d=0;break;case 1:f=c[0];q(a,Object.assign(k(a,f.newMessage),{action_type:b("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:f.replacedMessageId}),"deltaReplaceMessage",h);d=0;break;case 2:e=c[0];f=e.threadKey.otherUserFbId;var g;if(f==null){var j=e.threadKey.threadFbId;if(j==null)g=void 0;else{var l=b("MercuryThreadIDMap").getForFBID(a);l=l.getClientIDFromServerIDNow(j.toString());g=l==null?void 0:b("bs_caml_option").some(l)}}else{j=b("FBID.bs").ofString(f.toString());g=j!==void 0?b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(j))):void 0}if(g!==void 0){l=b("bs_caml_option").valFromOption(g);f={};j=parseInt(e.deliveredWatermarkTimestampMs,10);f[l]=j;b("MercuryDispatcher").getForFBID(a).handleUpdate({delivery_receipts:f,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});X(l,e.messageIds,j);d=b("bs_block").__(0,["DeltaDeliveryReceipt"])}else d=b("bs_block").__(1,["DeltaDeliveryReceipt","no thread id"]);break;case 3:g=U(a,c[0]);f=g[1];l=g[0];l.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[],global_actions:l,pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});f.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:f,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=l.length===0&&f.length===0?b("bs_block").__(1,["DeltaMarkRead","no local or global action"]):b("bs_block").__(0,["DeltaMarkRead"]);break;case 4:var m=c[0];e=b("bs_belt_Array").keepMapU(m.threadKeys,function(c){var d=i(a,c);if(d!==void 0){var e=parseInt(m.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(e);return{thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!1,timestamp:e,folder:b("MessagingTag").INBOX}}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:e,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMarkUnread"]);break;case 5:j=c[0];q(a,Object.assign(k(a,j),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:j.messageMetadata.adminText,log_message_data:{removed_participants:[b("MercuryIDs").getParticipantIDFromUserID(j.leftParticipantFbId)]},log_message_type:b("MercuryLogMessageType").UNSUBSCRIBE}),"DeltaParticipantLeftGroupThread",W(j.messageMetadata));d=0;break;case 6:g=c[0];q(a,Object.assign(k(a,g),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:g.messageMetadata.adminText,log_message_data:{added_participants:b("bs_belt_Array").map(g.addedParticipants,function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.userFbId)})},log_message_type:b("MercuryLogMessageType").SUBSCRIBE}),"DeltaParticipantsAddedToGroupThread",W(g.messageMetadata));d=0;break;case 7:l=c[0];q(a,Object.assign(k(a,l),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:l.messageMetadata.adminText,log_message_data:{name:l.name},log_message_type:b("MercuryLogMessageType").THREAD_NAME}),"DeltaThreadName",W(l.messageMetadata));d=0;break;case 8:f=c[0];e={watermark:parseInt(f.watermarkTimestampMs,10),action:parseInt(f.actionTimestampMs,10)};j=f.threadKey.otherUserFbId;g=j==null?b("bs_caml_option").nullable_to_opt(f.actorFbId):j.toString();l=f.threadKey.otherUserFbId;if(l==null){j=f.threadKey.threadFbId;f=j==null?void 0:j.toString()}else f=l.toString();if(g!==void 0)if(f!==void 0){j=f;l=b("MercuryThreadIDMap").getForFBID(a);f=l.getClientIDFromServerIDNow(j);if(f==null)d=b("bs_block").__(1,["DeltaReadReceipt","No clientID for serverID: "+j]);else{l={};j={};g=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(g));j[g]=e;l[f]=j;b("MercuryDispatcher").getForFBID(a).handleUpdate({roger:l,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d=b("bs_block").__(0,["DeltaReadReceipt"])}}else d=b("bs_block").__(1,["DeltaReadReceipt","serverID is invalid"]);else d=b("bs_block").__(1,["DeltaReadReceipt","userID is invalid"]);break;case 9:g=c[0];q(a,Object.assign(k(a,g),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:g.messageMetadata.adminText,log_message_data:{message_type:g.type,untypedData:g.untypedData},log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(g.messageMetadata.unsendType)}),"DeltaAdminTextMessage",W(g.messageMetadata));d=0;break;case 10:e=c[0];f=i(a,{otherUserFbId:e.threadKey.otherUserFbId,threadFbId:e.threadKey.threadFbId});j=f!==void 0?{action_type:b("MercuryActionType").DELETE_MESSAGES,message_ids:e.messageIds,other_user_fbid:V(e.threadKey.otherUserFbId),thread_fbid:V(e.threadKey.threadFbId),thread_id:f}:void 0;l=e.threadKey.threadFbId;g=e.folder;if(j!==void 0){f=b("bs_caml_option").valFromOption(j);l==null||g==null?(q(a,f,"DeltaMessageDelete",h),d=0):(g==="FOLDER_MONTAGE"?b("MontageActions").requestUpdate(l.toString()):q(a,f,"DeltaMessageDelete",h),d=0)}else d=b("bs_block").__(1,["DeltaMessageDelete","transform failed"]);break;case 11:e=c[0];j=i(a,{otherUserFbId:e.threadKey.otherUserFbId,threadFbId:e.threadKey.threadFbId});if(j!==void 0){g=e.action;q(a,{action_type:b("MercuryActionType").CHANGE_ARCHIVED_STATUS,thread_fbid:V(e.threadKey.threadFbId),other_user_fbid:V(e.threadKey.otherUserFbId),archived:g==null?!1:g===b("MessagingThreadAction").ACTION_ARCHIVED,thread_id:j},"DeltaThreadAction",h);d=0}else d=b("bs_block").__(1,["DeltaThreadAction","transform failed"]);break;case 12:l=b("bs_belt_Array").keepMapU(c[0].threadKeys,function(c){var d=i(a,c);if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").DELETE_THREAD,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadDelete"]);break;case 13:f=c[0];e=i(a,{otherUserFbId:null,threadFbId:f.messageMetadata.threadKey.threadFbId});e!==void 0?(q(a,{action_type:b("MercuryActionType").REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:V(f.messageMetadata.threadKey.threadFbId),other_user_fbid:null,removed_admin_ids:f.removedAdminFbIds,thread_id:e},"DeltaAdminRemovedFromGroupThread",h),d=0):d=b("bs_block").__(1,["DeltaAdminRemovedFromGroupThread","transform failed"]);break;case 14:g=c[0];j=i(a,g.threadKey);if(j!==void 0){l=[{thread_id:j,action_type:b("MercuryActionType").CHANGE_MUTE_SETTINGS,thread_fbid:g.threadKey.threadFbId,other_user_fbid:g.threadKey.otherUserFbId,mute_until:parseInt(g.expireTime,10)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadMuteSettings"])}else d=b("bs_block").__(1,["DeltaThreadMuteSettings","invalid thread ID"]);break;case 15:f=c[0];e=f.jsonBlob;if(e==null)d=b("bs_block").__(1,["DeltaPagesManagerEvent","no jsonBlob"]);else{try{j=JSON.parse(e)}catch(a){j={}}g=b("bs_js_json").classify(j);if(typeof g==="number"||g.tag!==2)d=b("bs_block").__(1,["DeltaPagesManagerEvent","jsonBlob is not an object"]);else{l=g[0];e=b("bs_js_dict").get(l,"type");if(e!==void 0){j=b("bs_js_json").classify(b("bs_caml_option").valFromOption(e));if(typeof j==="number"||j.tag!==1)d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not a number"]);else if(j[0]===b("PagesMessagingEventType").FLAG){g=b("bs_js_dict").get(l,"flagData");if(g!==void 0){e=b("bs_js_json").classify(b("bs_caml_option").valFromOption(g));if(typeof e==="number"||e.tag!==2)j=!1;else{l=b("bs_js_dict").get(e[0],"state");if(l!==void 0){g=b("bs_js_json").classify(b("bs_caml_option").valFromOption(l));j=typeof g==="number"?g===1:!1}else j=!1}}else j=!1;e=i(a,f.threadKey);if(e!==void 0){l=[{thread_id:e,action_type:b("MercuryActionType").CHANGE_FLAG,mark_as_flag:j,other_user_fbid:f.threadKey.otherUserFbId,thread_fbid:f.threadKey.threadFbId}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaPagesManagerEvent"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","threadID is invalid"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","type is not pagesFlag"])}else d=b("bs_block").__(1,["DeltaPagesManagerEvent","no type on jsonBlob"])}}break;case 16:g=c[0];e=i(a,{otherUserFbId:null,threadFbId:g.messageMetadata.threadKey.threadFbId});e!==void 0?(q(a,{action_type:b("MercuryActionType").APPROVAL_MODE,action_id:null,thread_fbid:V(g.messageMetadata.threadKey.threadFbId),other_user_fbid:null,approval_mode:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessengerApprovalModeTypes"),g.mode)),thread_id:e},"DeltaApprovalMode",h),d=0):d=b("bs_block").__(1,["DeltaApprovalMode","transform failed"]);break;case 17:j=c[0];f=i(a,{otherUserFbId:j.messageMetadata.threadKey.otherUserFbId,threadFbId:j.messageMetadata.threadKey.threadFbId});if(f!==void 0){l=f;g=j.inviterFbId;if(g==null){e=j.recipientFbId;if(!(e==null)){f=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(e));e=j.action===b("MessengerApprovalQueueTypes").REMOVED;var p=j.action===b("MessengerApprovalQueueTypes").REQUESTED;q(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:V(j.messageMetadata.threadKey.threadFbId),other_user_fbid:V(j.messageMetadata.threadKey.otherUserFbId),removed_id:e?f:null,added_id:p?f:null,thread_id:l},"DeltaApprovalQueue",h)}}else{e=j.action===b("MessengerApprovalQueueTypes").REMOVED;p=j.action===b("MessengerApprovalQueueTypes").REQUESTED;if(p){f=j.requestSource;var r;if(f==null)r=b("MessengerGroupRequestSource").ADD;else switch(f){case"ADD":r=b("MessengerGroupRequestSource").ADD;break;case"JOIN_THROUGH_LINK":r=b("MessengerGroupRequestSource").JOIN_THROUGH_LINK;break;default:r=b("MessengerGroupRequestSource").ADD}p={requester:{id:j.recipientFbId},inviter:{id:g},request_source:r,request_timestamp:j.requestTimestamp}}else p=null;q(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:V(j.messageMetadata.threadKey.threadFbId),other_user_fbid:V(j.messageMetadata.threadKey.otherUserFbId),removed_group_id:e?j.recipientFbId:null,added_group_id:p,thread_id:l},"DeltaApprovalQueue",h)}d=0}else d=b("bs_block").__(1,["DeltaApprovalQueue","transform failed"]);break;case 18:f=c[0];q(a,k(a,f.deltaNewMessage),"DeltaGenieMessage",W(f.deltaNewMessage.messageMetadata));d=0;break;case 19:g=c[0];e=g.messageMetadata.threadKey;if(e==null)j=void 0;else{p=e.threadFbId;j=p==null?void 0:p}l=g.initiator;if(l==null)f=void 0;else{e=l.userFbId;f=e==null?void 0:e.toString()}p=i(a,{otherUserFbId:null,threadFbId:j});p!==void 0?(q(a,{action_type:b("MercuryActionType").UPDATE_RTC_CALL_DATA,thread_fbid:V(j),other_user_fbid:null,call_state:g.callState,server_info_data:g.serverInfoData,initiator_fbid:f,thread_id:p},"DeltaRTCCallData",h),d=0):d=b("bs_block").__(1,["DeltaRTCCallData","transform failed"]);break;case 20:l=c[0];e=i(a,l.threadKey);if(e!==void 0){j=[{thread_id:e,action_type:b("MercuryActionType").CHANGE_FOLDER,other_user_fbid:l.threadKey.otherUserFbId,new_folder:b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,l.folder)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:j,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaThreadFolder"])}else d=b("bs_block").__(1,["DeltaThreadFolder","threadID is invalid"]);break;case 21:g=c[0];f=i(a,g.threadKey);if(f!==void 0){p=[{thread_id:f,action_type:b("MercuryActionType").MUTATE_TAGS,messageId:g.messageId,tags_to_add:g.tagsToAdd,tags_to_delete:g.tagsToDelete}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:p,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=b("bs_block").__(0,["DeltaMutateMessageTags"])}else d=b("bs_block").__(1,["DeltaMutateMessageTags","threadID is invalid"]);break;case 22:d=T(a,c[0]);break}if(typeof d==="number")return 0;else if(d.tag)return o(d[0],d[1]);else return n(d[0])}function a(a,c){__p&&__p();if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").NewMessage))return Y(a,b("bs_block").__(0,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReplaceMessage))return Y(a,b("bs_block").__(1,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").DeliveryReceipt))return Y(a,b("bs_block").__(2,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkRead))return Y(a,b("bs_block").__(3,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkUnread))return Y(a,b("bs_block").__(4,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantLeftGroupThread))return Y(a,b("bs_block").__(5,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread))return Y(a,b("bs_block").__(6,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadName))return Y(a,b("bs_block").__(7,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReadReceipt))return Y(a,b("bs_block").__(8,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminTextMessage))return Y(a,b("bs_block").__(9,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MessageDelete))return Y(a,b("bs_block").__(10,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadAction))return Y(a,b("bs_block").__(11,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadDelete))return Y(a,b("bs_block").__(12,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminRemovedFromGroupThread))return Y(a,b("bs_block").__(13,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadMuteSettings))return Y(a,b("bs_block").__(14,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").PagesManagerEvent))return Y(a,b("bs_block").__(15,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalMode))return Y(a,b("bs_block").__(16,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalQueue))return Y(a,b("bs_block").__(17,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ClientPayload))return Y(a,b("bs_block").__(22,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").GenieMessage))return Y(a,b("bs_block").__(18,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").RtcCallData))return Y(a,b("bs_block").__(19,[c]));else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkFolderSeen)){n("DeltaMarkFolderSeen");return b("MessengerState.bs").send(b("bs_caml_option").some(a),[b("bs_block").__(0,[b("bs_block").__(66,[c])])])}else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadFolder))return Y(a,b("bs_block").__(20,[c]));else return 0}f.transform=a}),null);
__d("MessengerState.bs",["invariant","URI","FBID.bs","bs_array","bs_block","bs_curry","JSSet.bs","React","Utils.bs","FBJSON","Arbiter","gkx","bs_js_dict","qex","bs_belt_Map","bs_belt_Set","bs_caml_obj","JSLogger","ThreadId.bs","FBIDCheck","immutable","bs_belt_Array","bs_caml_array","ChatConfig","LogHistory","MercuryIDs","bs_pervasives","bs_belt_Option","bs_caml_option","CurrentUser","AsyncRequest","MessagingTag","RemoteAction.bs","TypingStates","MercuryAssert","MercuryViewer","ParticipantId.bs","bs_belt_MapString","bs_caml_primitive","MercuryFilters.bs","ImmutableObject","MercuryLocalIDs","ChannelConstants","MessengerFolders.bs","MessengerMessage.bs","bs_js_null_undefined","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercuryMessageIDs.bs","MercuryThreadInfo","MessengerPersonas.bs","XGroupsController","MercuryThreadIDMap","PageCommItemStatus","MercuryActionStatus","MessageRequestUtils","MessagingThreadType","MercuryPayloadSource","MessengerEnvironment","MessengerThreadUtils.bs","recoverableViolation","MercuryLogMessageType","MercuryServerRequests","MercuryThreadInformer","MercurySyncEventsProxy","unrecoverableViolation","MercuryGlobalActionType","MessageProfileRangeType","ThreadConnectivityStatus.bs","MercuryMessageClientState","MessengerGroupsSyncStatus","MercuryThreadlistConstants","MessageUnsendabilityStatus","setTimeoutAcrossTransitions","MessagingGenericAdminTextType","MessengerDesktopNotifications","ChatReliabilityInstrumentation","RemovedMessageTombstoneContent","MessengerThreadCannotReplyReason.bs","RepliedToMessageStatusForGraphQL","XMercuryThreadLikeIconController","MessengerSharedMediaActionsLoader","MessengerSharedPhotosVideosBaseData.bs","MercuryDisplayTimeFilterMessageRenderer"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;function i(a){var c={};b("bs_belt_Map").forEach(a,function(b,a){c[b]=a;return 0});return c}function a(a){return i(a[7])}function j(a,c){return b("bs_js_null_undefined").fromOption(b("bs_belt_Map").get(a[7],c))}function c(a){return a[0]}function d(a){return a[1]}function e(a){return a[2]}function k(a){return a[3]}function l(a){return a[4]}function m(a){return a[5]}function aa(a){return a[6]}function ba(a){return a[8]}function ca(a){return a[9]}function da(a){return a[10]}function n(a){return a[11]}function o(a){return a[12]}function p(a){return a[13]}function q(a){return a[14]}function ea(a){return a[15]}function fa(a){return a[16]}function ga(a){return a[17]}function ha(a){return a[18]}function r(a){b("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(b("FBJSON").stringify({otid:a.offline_threading_id,message_id:a.message_id,other_user_fbid:a.other_user_fbid}));return 0}function ia(a,c,d){d=d.reduce(b("bs_belt_Set").remove,c.reduce(b("bs_belt_Set").add,a[3]));if(d===a[3])return a;else return[a[0],a[1],a[2],d,a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}var ja=function(a,b){delete a[b];return 0};function ka(a,d,e){var f=b("bs_belt_MapString").get(a,d);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);var c=b("bs_belt_Map").get(f,e);if(c!==void 0)return b("bs_belt_MapString").set(a,d,b("bs_belt_Map").remove(f,e));else return a}else return a}function la(a,c){__p&&__p();var d=c.thread_fbid;if(d==null)if(c.type==="typ"||c.type==="page_typing"){c=b("FBID.bs").ofString(c.from.toString());if(c!==void 0)return b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(c));else return null}else return null;else{c=b("MercuryThreadIDMap").getForFBID(a);return c.getClientIDFromServerIDNow(d.toString())}}var ma=b("gkx")("1275193"),na=ma?b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups,b("MercuryFilters.bs").named,b("MercuryFilters.bs").unnamed]):b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups]),oa=b("MessengerFolders.bs").getSupportedFolders(0).concat([b("MessagingTag").SPAM,b("MessagingTag").PAGE_BACKGROUND]);function pa(a){var b={};oa.forEach(function(a){var c={};na.forEach(function(a){c[a]={threadlist:[],reachedEnd:!1,existingIDs:new Set()};return 0});b[a]=c;return 0});return b}function qa(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.invalidatedThread(c);return 0}function s(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.updatedThread(c);return 0}function ra(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.deletedThread(c);return 0}function sa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.changedThreadReadState(c,d,e);return 0}function ta(a,c){__p&&__p();var d=new Map();c.forEach(function(a,b){d.set(a,b);return 0});return c.sort(function(e,f){__p&&__p();var c=b("bs_belt_Map").get(a[7],e),g=b("bs_belt_Map").get(a[7],f);if(c!==void 0&&g!==void 0){g=b("bs_caml_option").valFromOption(g).timestamp-b("bs_caml_option").valFromOption(c).timestamp;if(g>0)return 1;else if(g<0)return-1;else return 0}c=d.get(e);g=d.get(f);return b("bs_belt_Option").getExn(c==null?void 0:b("bs_caml_option").some(c))-b("bs_belt_Option").getExn(g==null?void 0:b("bs_caml_option").some(g))|0})}function ua(a,c,d,e){__p&&__p();a=b("bs_js_dict").get(a[12],d);if(a!==void 0){d=b("bs_js_dict").get(b("bs_caml_option").valFromOption(a),e);if(d!==void 0){var f=b("bs_caml_option").valFromOption(d);c.forEach(function(a){if(f.existingIDs.has(a)){f.existingIDs["delete"](a);a=f.threadlist.indexOf(a);f.threadlist.splice(a,1);return 0}else return 0});return 0}else return 0}else return 0}function t(c,d,e,f){__p&&__p();c=c!==void 0?c:function(a){return!0};var a=b("bs_belt_Map").get(d[7],e);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);if(b("bs_curry")._1(c,a)){c=b("ImmutableObject").set(a,f);a=b("bs_belt_Map").set(d[7],e,c);s(d[0],e);return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],a,d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15],d[16],d[17],d[18]]}else return d}else return d}function va(c,a,d){__p&&__p();var e=new Set(a.participants);Object.assign(a,{participants:Array.from(a.participants)});d.forEach(function(d){if(e.has(d))return 0;else{a.participants.push(d);if(b("bs_caml_obj").caml_equal(d,c)){Object.assign(a,{is_subscribed:!0,can_reply:!0,cannot_reply_reason:null});return 0}else return 0}});return 0}function u(a){__p&&__p();var c=[b("MercuryFilters.bs").all];a.unread_count>0&&c.push(b("MercuryFilters.bs").unread);a.is_canonical||c.push(b("MercuryFilters.bs").groups);if(b("gkx")("1275193"))if(a.name.length!==0){c.push(b("MercuryFilters.bs").named);return c}else{c.push(b("MercuryFilters.bs").unnamed);return c}else return c}function wa(a,b,c){return t(void 0,a,b,{solid_color:c.solid_color,header_color:c.header_color,footer_color:c.footer_color,gradient_colors:c.gradient_colors,theme_id:c.theme_id,reactions:c.reactions})}function xa(c,d,e,f){__p&&__p();var a=b("gkx")("1275193"),g=a?d.filter(function(a){a=b("bs_belt_Map").get(c[7],a);if(a!==void 0){a=u(b("bs_caml_option").valFromOption(a));return a.some(function(a){return a===f})}else return!1}):d;oa.forEach(function(a){if(a!==e)return ua(c,g,a,f);else return 0});a=b("bs_js_dict").get(c[12],e);if(a!==void 0){d=b("bs_js_dict").get(b("bs_caml_option").valFromOption(a),f);if(d!==void 0){a=b("bs_caml_option").valFromOption(d);d=[a.threadlist,a.existingIDs]}else d=[[],new Set()]}else d=[[],new Set()];var h=d[1],i=d[0];g.forEach(function(a){if(h.has(a))return 0;else{h.add(a);i.push(a);return 0}});return[ta(c,i),h]}function ya(c,d,e){__p&&__p();if(e!==void 0){var a=b("bs_js_dict").get(c[16],d);if(a!==void 0){b("bs_caml_option").valFromOption(a).add(b("bs_caml_option").valFromOption(e));a=b("MercuryThreadInformer").getForFBID(c[0]);a.updatedUnreadState();return 0}else{e=b("MercuryServerRequests").getForFBID(c[0]);e.fetchUnreadThreadIDs(d);return 0}}else return 0}var za=b("MessengerFolders.bs").getSupportedFolders(0).filter(function(a){return a!==b("MessagingTag").ACTION_ARCHIVED});function Aa(c,d,e){__p&&__p();if(e!==void 0){var a=b("bs_js_dict").get(c[16],d);if(a!==void 0){b("bs_caml_option").valFromOption(a)["delete"](b("bs_caml_option").valFromOption(e));a=b("MercuryThreadInformer").getForFBID(c[0]);a.updatedUnreadState();return 0}else{e=b("MercuryServerRequests").getForFBID(c[0]);e.fetchUnreadThreadIDs(d);return 0}}else return 0}function Ba(c,a,d){var e=b("MessengerFolders.bs").getFromMeta(a);if(d!==e){za.includes(e)&&a.unread_count>0&&ya(c,e,b("bs_caml_option").some(a.thread_id));if(za.includes(d))return Aa(c,d,b("bs_caml_option").some(a.thread_id));else return 0}else return 0}function Ca(a,c,d,e){var f=a[12][c][d],g=f.existingIDs.has(e);xa(a,[e],c,d);if(!b("gkx")("1275193")||f.threadlist.length!==0){var h=b("bs_caml_array").caml_array_get(f.threadlist,f.threadlist.length-1|0)===e;if(!f.reachedEnd&&!g&&h)return ua(a,[e],c,d);else return 0}else return 0}function Da(a,c,d){if(oa.includes(c))if((c===b("MessagingTag").INBOX||c===b("MessagingTag").ACTION_ARCHIVED||c===b("MessagingTag").PENDING)&&b("gkx")("1275193"))return Ca(a,c,b("MercuryFilters.bs").unread,d);else{xa(a,[d],c,b("MercuryFilters.bs").unread);return 0}else return 0}function Ea(c,a){var d=b("MessengerFolders.bs").getFromMeta(a);if(oa.includes(d)){na.forEach(function(b){return Ca(c,d,b,a.thread_id)});return 0}else return 0}function Fa(c,d,e,f){__p&&__p();var a=b("bs_belt_Map").get(c[7],d);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);var g=b("MessengerFolders.bs").getFromMeta(a);if(g!==e){if(f){f=a.comm_status;f=f==null?b("ImmutableObject").set(a,{folder:e}):e===b("MessagingTag").OTHER?b("ImmutableObject").set(a,{folder:e,comm_status:b("PageCommItemStatus").SPAM}):e===b("MessagingTag").INBOX?b("ImmutableObject").set(a,{folder:e,comm_status:b("PageCommItemStatus").TODO}):b("ImmutableObject").set(a,{folder:e})}else f=a;var h=a.other_user_fbid;h=h==null?[]:e===b("MessagingTag").OTHER?[b("MercuryIDs").getParticipantIDFromUserID(h)]:[];var i=a.other_user_fbid;e=i==null?[]:e===b("MessagingTag").OTHER?[]:[b("MercuryIDs").getParticipantIDFromUserID(i)];i=ia(c,h,e);h=b("bs_belt_Map").set(i[7],d,f);Ba(i,f,g);Ea(i,f);s(i[0],d);return[i[0],i[1],i[2],i[3],i[4],i[5],i[6],h,i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15],i[16],i[17],i[18]]}else{Ea(c,a);return c}}else return c}function v(a,d,e){__p&&__p();e=d.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(d):e!==void 0?e:d.body;var c=d.raw_attachments;c=!(c==null)&&c.length!==0?b("MercuryAttachment").convertRaw(c):d.attachments;var f=d.removed_timestamp;if(f==null){f=d.log_message_type;e={snippet:e,snippet_attachments:c,snippet_sender:f==null?d.author:null}}else e={snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(d.author),snippet_attachments:null,snippet_sender:null};return Object.assign(a,e)}function Ga(c,d,e){var a=c.event_title,f=c.event_time;c=c.event_location_name;return{creator_id:null,latitude:null,location_address:null,longitude:null,note:"",related_event:{id:""},repeat_mode:null,seconds_to_notify_before:0,status:null,track_rsvp:d.track_rsvp,title:a==null?d.title:a,event_time:f==null?d.event_time:parseInt(f,10),location_name:c==null?d.location_name:c,event_members:e!==void 0?b("bs_caml_option").valFromOption(e):d.event_members,oid:d.oid,event_type:d.event_type}}function Ha(b,a){var c={};Object.keys(b).forEach(function(a){c[a]=b[a];return 0});c[a.guest_id]=a.guest_status;return c}var Ia=function(a,b){delete a[b];return 0},Ja=function(a,b){delete a[b];return 0};function w(a){__p&&__p();var c=[-1],d=[null],e=Math.floor(Date.now()/1e3);b("bs_js_dict").entries(a).forEach(function(a){a=a[1];var b=a.event_time;if(b>e&&(c[0]<0||c[0]>b)){c[0]=b;d[0]=a;return 0}else return 0});return d[0]}function Ka(a,c,d){d=b("XMercuryThreadLikeIconController").getURIBuilder().setString("emoji",d).getURI();new(b("AsyncRequest"))(d).setHandler(function(d){var e=b("MercuryDispatcher").getForFBID(a);e.handleUpdate({actions:[{action_type:b("MercuryActionType").UPDATE_CUSTOM_LIKE,thread_id:c,custom_like:d.getPayload()}],from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE});return 0}).send();return 0}function La(d,a,c,e){__p&&__p();c=c.log_message_data;if(c==null)return 0;else{var f=c.untypedData;if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME){var g=a.custom_nickname;if(!(g==null)){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(g));var h=f.nickname;h.trim().length>0?g[f.participant_id]=h:b("bs_curry")._2(Ja,g,f.participant_id);Object.assign(a,{custom_nickname:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_ICON)Ka(d,e,f.thread_icon);else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_THEME){if(!b("ChatConfig").get("chat_tab_has_gradients")){h=f.theme_color;if(h==null)Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});else if(h.length>0){g="#"+h.slice(2);Object.assign(a,{solid_color:g,header_color:g,footer_color:g,gradient_colors:[g]})}else Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});s(d,e)}}else if(f!==void 0)if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE){var i={},k=f.event_creator_id;a.participants.forEach(function(c){c=b("MercuryIDs").getUserIDFromParticipantID(c);if(c==null)return 0;else{var a=b("bs_caml_obj").caml_equal(c,k);i[c]=a?"GOING":"INVITED";return 0}});h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g=f.event_time;g={track_rsvp:f.event_track_rsvp,title:f.event_title,event_time:g==null?0:parseInt(g,10),location_name:f.event_location_name,event_members:i,oid:f.event_id,event_type:f.event_type};Object.assign(a,{lightweight_event:g});h[f.event_id]=Object.assign({},g);Object.assign(a,{lightweight_events:h});s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION){g=a.lightweight_event;if(!(g==null)){h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g.oid===f.event_id&&Object.assign(a,{lightweight_event:Ga(f,g,b("bs_caml_option").some(g.event_members))});g=b("bs_js_dict").get(h,f.event_id);g!==void 0&&(h[f.event_id]=Ga(f,b("bs_caml_option").valFromOption(g),void 0),Object.assign(a,{lightweight_events:h}))}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));h=a.lightweight_event;if(!(h==null)&&h.oid===f.event_id){var l=Ha(h.event_members,f);Object.assign(a,{lightweight_event:Ga(f,h,b("bs_caml_option").some(l))})}h=b("bs_js_dict").get(g,f.event_id);if(h!==void 0){l=b("bs_caml_option").valFromOption(h);h=Ha(l.event_members,f);g[f.event_id]=Ga(f,l,b("bs_caml_option").some(h));Object.assign(a,{lightweight_events:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY){l=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));b("bs_curry")._2(Ia,l,f.event_id);Object.assign(a,{lightweight_event:w(l),lightweight_events:l});s(d,e)}return 0}}function Ma(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.updatedMessage(c,d,b("bs_js_null_undefined").fromOption(e));return 0}function x(c,a){c=b("MercuryThreadInformer").getForFBID(c);c.receivedMessage(a);return 0}function Na(a,c,d){a=b("MercuryThreadInformer").getForFBID(a);a.reorderedMessages(c,d);return 0}function Oa(a,c,d,e,f){a=b("MercuryThreadInformer").getForFBID(a);f=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_belt_Array").keepMap(a,function(a){return b("bs_caml_option").nullable_to_opt(a.message_file_fbid)})}),[]);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),f);return 0}function Pa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),null);return 0}var Qa=function(a,b){delete a[b];return 0};function Ra(c,a){var d=c[10].get(a);return b("bs_caml_option").nullable_to_opt(c[9].get(b("bs_belt_Option").getWithDefault(d==null?void 0:b("bs_caml_option").some(d),a)))}function y(a,c,d){a=a!==void 0?a:!1;d=b("bs_belt_Array").keepMap(d,function(a){return Ra(c,a)});if(a)return d.slice().reverse();else return d}function Sa(a,c){return b("bs_belt_Array").keepMap(c,function(b){return Ra(a,b)}).sort(function(a,c){return b("MessengerMessage.bs").compare(c,a)}).map(function(a){return a.message_id})}function Ta(a,b){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9].set(b[0],b[1]),a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}function Ua(b,a){b[10].set(a.message_id,a.message_id);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}var z=function(a,b){delete a[b];return 0};function Va(c,d){__p&&__p();var a=c[15];Object.keys(d).forEach(function(f){__p&&__p();var e=b("bs_js_dict").get(d,f);if(e!==void 0){e=e;var g=e[0],h=g[2],i=g[1];g=a.get(g[0]);if(g==null)return 0;else{g=g[1];if(g.length>=(i+h|0)){b("bs_curry")._2(z,d,f);return b("bs_curry")._1(e[1],y(!0,c,g.slice(i,i+h|0)))}else return 0}}else return 0});return 0}function Wa(e,d,f){__p&&__p();var c=f[1],g=f[0];b("MessengerMessage.bs").finalizeRanges(c);var a=c.offline_threading_id;if(!(a==null)&&a!==c.message_id){e[10].set(a,c.message_id);b("MercuryMessageIDs.bs").addServerID(a,c.message_id);a=c.threading_id;a==null||b("MercuryMessageIDs.bs").addServerID(a,c.message_id)}a=e[9].has(g);var h=e[0],i=e[1],j=e[2],k=e[3],l=e[4],m=e[5],aa=e[6],ba=e[7],ca=e[8],da=e[9].set(g,c),n=e[10],o=e[11],p=e[12],q=e[13],ea=e[14],fa=e[15],ga=e[16],ha=e[17];e=e[18];h=[h,i,j,k,l,m,aa,ba,ca,da,n,o,p,q,ea,fa,ga,ha,e];if(!a&&f[2]===1){i=b("MercuryIDs").isLocalThread(c.thread_id);j=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(fa.get(a))}),[i?1:0,[]]);k=c.thread_id;if(!(k==null)){l=Sa(h,[g].concat(j[1].filter(function(a){return b("bs_caml_obj").caml_notequal(a,c.offline_threading_id)})));fa.set(k,[j[0],l])}Va(h,d[3][0])}return h}function Xa(b,c,a){b[11].set(c,a);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}function Ya(a,c){var d=c[1];c=c[0];var e=a[11].get(c);b("bs_belt_Option").isSome(e==null?void 0:b("bs_caml_option").some(e))||g(0,1777);a[11]["delete"](c);if(e==null)return b("bs_pervasives").failwith("Message must exist to update");else return Object.assign(e,{image_ids:d.image_ids,file_ids:d.file_ids,audio_ids:d.audio_ids,gif_ids:d.gif_ids,video_ids:d.video_ids,client_state:b("MercuryMessageClientState").SEND_TO_SERVER})}function Za(c,d){__p&&__p();var e=d[0],a=c[15].get(e);if(a==null)return c;else{var f=b("bs_belt_Array").keepMap(d[1],function(a){return Ra(c,a)}).map(function(a){return a.message_id}),g=Sa(c,a[1].filter(function(a){return f.indexOf(a)===-1}));c[15].set(e,[a[0],g]);Na(c[0],e,b("bs_js_null_undefined").fromOption(d[2]));return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]]}}function $a(d,e){__p&&__p();var f={snippet:"...",snippet_attachments:null,snippet_sender:null};e=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(d[15].get(e)),function(a){return b("bs_belt_Array").get(y(void 0,d,a[1]),0)});if(e!==void 0){var c=b("bs_caml_option").valFromOption(e);c=c.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(c):c.body}else c=null;if(e!==void 0){e=b("bs_caml_option").valFromOption(e);var a=e.removed_timestamp;if(a==null)if(c==null)return f;else{a=e.log_message_type;return{snippet:c,snippet_attachments:e.attachments,snippet_sender:a==null?e.author:null}}else return{snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(e.author),snippet_attachments:null,snippet_sender:null}}else return f}function ab(d,c){__p&&__p();var a=c.attachments;if(a==null)return 0;else{var e=b("bs_belt_Array").keepMap(a,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}});b("MessengerSharedMediaActionsLoader").deletePhotos(b("MercuryIDs").getThreadFBIDFromThreadID(c.thread_id),e);if(d!==void 0)return b("MessengerSharedPhotosVideosBaseData.bs").localRemove(b("bs_caml_option").valFromOption(d),b("bs_belt_Array").keepMap(a,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}}));else return 0}}function bb(a,c,d){__p&&__p();d=a[15].get(d);if(d==null)return a;else{d=d[1];var e=[!0];return b("bs_belt_Array").reduce(d,a,function(f,d){__p&&__p();if(e[0]){var g=f[10].get(d);g=b("bs_belt_Option").getWithDefault(g==null?void 0:b("bs_caml_option").some(g),d);if(g===c){e[0]=!1;return f}else{d=Ra(f,g);if(d!==void 0){d=b("bs_caml_option").valFromOption(d);var a=d.replied_to_message,h;if(a==null)h=void 0;else{a=a.message;if(a==null)h=void 0;else{var i=f[10].get(a.message_id);h=b("bs_belt_Option").getWithDefault(i==null?void 0:b("bs_caml_option").some(i),a.message_id)}}if(h!==void 0&&h===c){i={status:b("RepliedToMessageStatusForGraphQL").DELETED,message:null};a=Object.assign(Object.assign({},d),{replied_to_message:i});return Ta(f,[g,a])}else return f}else return f}}else return f})}}function cb(a,c){__p&&__p();if(!(a==null)&&a.length!==0){a=a;var d=c;c=b("bs_array").map(function(a){var c=a.type;if(b("bs_caml_obj").caml_equal(c,b("MessageProfileRangeType").THREAD_ACTIVE)||b("bs_caml_obj").caml_equal(c,b("MessageProfileRangeType").THREAD))return b("gkx")("678578");else{c=a.id;if(c==null)return!1;else return b("bs_caml_obj").caml_equal(b("FBID.bs").ofStringExn(c),d)}},a);return b("bs_array").fold_left(function(a,b){if(a)return!0;else return b},!1,c)}else return!1}function db(e,d,f,g){__p&&__p();var a=f.client_message_id,h;if(a==null)h=e;else{var i=Ra(e,a);if(i!==void 0){i=b("bs_caml_option").valFromOption(i);var j=f.message_id,k=f.status;if(b("bs_caml_obj").caml_equal(i.status,b("MercuryActionStatus").SUCCESS))h=e;else if(e[9].has(j)){var c=Object.assign(Object.assign({},i),f);Ma(e[0],c.thread_id,c.message_id,g);h=Ta(e,[j,c])}else{c=b("bs_caml_obj").caml_equal(f.status,b("MercuryActionStatus").SUCCESS);c=c?f.error_data:null;b("MercuryMessageIDs.bs").addServerID(a,j);e[10].set(a,j);var l;if(b("gkx")("708253")&&b("gkx")("1268229")){var m=f.attachments,aa=i.preview_attachments;if(m==null||aa==null)l=f.attachments;else{var ba=[0];l=m.map(function(a){var c=b("bs_belt_Array").get(aa,ba[0]);if(c!==void 0){ba[0]=ba[0]+1|0;return Object.assign(Object.assign({},a),{preview_url:b("bs_caml_option").valFromOption(c).preview_url})}else{ba[0]=ba[0]+1|0;return a}})}}else l=f.attachments;m=Object.assign(Object.assign({},i),{status:k,error_data:c,timestamp:f.timestamp,log_message_data:f.log_message_data,ranges:f.ranges,attachments:l,has_attachment:f.has_attachment,is_one_way_sent:f.is_one_way_sent,is_forwarded:f.is_forwarded});b("MessengerMessage.bs").finalizeRanges(m);i=Ta(e,[j,m]);i[9].set(a,{});i[9]["delete"](a);k=m.thread_id;c=i[15].get(k);if(!(c==null)){l=Sa(i,c[1]);i[15].set(k,[c[0],l])}Ma(i[0],m.thread_id,m.message_id,g);k=b("MessengerMessage.bs").isTitanMessage(m);c=d[2].get(m.thread_id);k&&(c==null||d[2].set(m.thread_id,c-1|0));h=[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10].set(a,j),i[11],i[12],i[13],i[14],i[15],i[16],i[17],i[18]]}}else h=e}l={};g=f.log_message_type;if(g==null)Object.assign(l,{snippet_attachments:f.attachments});else{if(b("bs_caml_obj").caml_equal(g,b("MercuryLogMessageType").THREAD_IMAGE)){k=f.log_message_data;if(k==null)d=null;else{m=k.image;d=m==null?null:m.preview_url}Object.assign(l,{image_src:d});s(h[0],f.thread_id)}b("bs_caml_obj").caml_notequal(g,b("MercuryLogMessageType").SUBSCRIBE)&&b("bs_caml_obj").caml_notequal(g,b("MercuryLogMessageType").UNSUBSCRIBE)&&Object.assign(l,{snippet_attachments:f.attachments})}return t(void 0,h,f.thread_id,l)}function eb(c,a,d,e){__p&&__p();if(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").SEND_MESSAGE))return db(c,a,d,e);else{var f=d.offline_threading_id;f=b("bs_belt_Option").flatMap(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_caml_option").nullable_to_opt(c[10].get(a))});var g=Ra(c,d.message_id);if(f!==void 0)if(g!==void 0){f=b("bs_caml_option").valFromOption(g);if(b("bs_caml_option").nullable_to_opt(f.sticker_id)!==void 0){var h=Object.assign(f,{attachments:d.attachments});return Ta(c,[f.message_id,h])}else return c}else return c;else if(g!==void 0)return c;else{f=b("bs_caml_obj").caml_equal(e,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))?Ua(c,d):c;h=b("bs_caml_obj").caml_equal(d.client_state,b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER);g=d.upload_id;e=h&&!(g==null)?Xa(f,g,d):f;h=b("MessengerMessage.bs").isErrorLogMessage(d);g=d.thread_id;h&&(g==null||(a[6][0][g]=!0));f=d.manual_retry_cnt;h=d.thread_id;f==null||!(h==null)&&f>0&&Na(e[0],h,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE);g=Wa(e,a,[d.message_id,d,1]);x(g[0],d);return g}}}function fb(a,c,d,e){__p&&__p();if(c!==void 0){c=b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(c),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE);var f=d.thread_id;if(c&&!(f==null)){c=b("MercuryThreadInformer").getForFBID(a);return b("bs_curry")._3(e,c,f,d)}else return 0}else return 0}function gb(a,b){var c=a.participants.indexOf(b);if(c>0){Object.assign(a,{participants:[b].concat(a.participants.slice(0,c),a.participants.slice(c+1|0))});return 0}else return 0}function hb(c,d,e,f){__p&&__p();var a=d.thread_id;if(a==null)return c;else{var g=b("bs_belt_Map").get(c[7],a);if(g!==void 0){g=b("bs_caml_option").valFromOption(g);var h={};if(!d.skip_bump_thread&&b("bs_caml_obj").caml_notequal(e,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO))){v(h,d,b("bs_caml_option").nullable_to_opt(d.log_message_body));if(d.timestamp>g.timestamp){Object.assign(h,{timestamp:d.timestamp});if(d.is_unread){Object.assign(h,{unread_count:g.unread_count+1|0});e=cb(d.profile_ranges,c[0]);e&&Object.assign(h,{unread_mentions_count:g.unread_mentions_count+1|0})}}Object.assign(h,{message_count:g.message_count+1|0,is_archived:!1})}f!==!0&&(d.timestamp>h.server_timestamp&&Object.assign(h,{server_timestamp:d.timestamp}));if(b("bs_caml_obj").caml_notequal(h,{}))return t(void 0,c,a,h);else return c}else return c}}function ib(b,a,c){var d=new Set(c);Object.assign(a,{participants:a.participants.filter(function(a){return!d.has(a)})});if(d.has(b)){Object.assign(a,{can_reply:!1,is_subscribed:!1});return 0}else return 0}function jb(c,a,d){a=a.specific_to_list;if(a==null){d=b("MercuryIDs").tokenize(d);if(d.type!=="user"||d.value.length===0)return[c];else return[b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d.value)),c]}else return a}function kb(d,c,e){var f=b("MercuryIDs").tokenize(e),g=f.type==="user",a=c.specific_to_list;a=g?!0:a==null?!1:b("MessengerThreadUtils.bs").isCanonicalFromInitialParticipants(d,a);if(a||g)d=jb(d,c,e);else{var h=c.specific_to_list;d=h==null?[]:h}return new(b("ImmutableObject"))({admins:{},admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:!0,cannot_reply_reason:null,can_viewer_report:!1,comm_item_owners:null,comm_source_id:null,comm_status:null,comm_icon_type:[],custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,gradient_colors:[],group_approval_queue:null,group_thread_subtype:null,work_associated_group:null,pinned_messages:null,groups_sync_status:null,has_email_participant:!1,has_montage:!1,unread_mentions_count:0,header_color:null,is_canonical_neo_user:!1,is_from_weak_entry_point:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{link:"",mode:0},last_message_timestamp:0,last_message_type:null,last_message_admin_text_type:null,last_message_unsendability_status:null,last_message_id:null,last_read_timestamp:0,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,page_comm_item_id:null,page_thread_info:null,page_unsubscribe_status:!1,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!0,rtc_call_data:null,server_timestamp:0,solid_color:null,subtitle:null,theme_id:null,reactions:void 0,thread_associated_job_applications:null,thread_associated_page_admin:null,thread_connectivity_data:null,thread_fbid:null,thread_type:null,thread_pin_timestamp:null,thread_id:e,participants:d,name:"",snippet:c.body,snippet_attachments:[],snippet_sender:c.author,unread_count:0,message_count:0,image_src:null,timestamp:c.timestamp,other_user_fbid:g?b("FBID.bs").ofStringExn(f.value):null,is_canonical_user:g,is_canonical:a,is_subscribed:!0,folder:b("MessagingTag").INBOX,is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,object_association_type:null,joinable_link:null,linked_mentorship_programs:null,thread_unsendability_status:null,is_business_page_active:!1,graphql_token:null})}function lb(d,e,c,f){__p&&__p();f=b("MessengerMessage.bs").hasServerTimestamp(c,f);var a=c.thread_id;if(a==null)return;else{b("MercuryAssert").isThreadID(a);e=b("bs_belt_Map").get(e,a);if(e!==void 0)return b("bs_caml_option").some(b("bs_caml_option").valFromOption(e));else if(b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&!f)return b("bs_caml_option").some(kb(b("MercuryIDs").getParticipantIDFromUserID(d),c,a));else return}}function mb(c,d){__p&&__p();var a=d.other_user_fbid;if(a==null){var e=d.thread_fbid;e=e==null?void 0:b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(e))}else e=b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(a));a=d.thread_id;e=a==null?e:a==null?void 0:b("bs_caml_option").some(a);a=d.thread_id;var f;if(a==null)f="";else{a=b("bs_belt_Map").get(c[7],a);f=a!==void 0?b("MessengerFolders.bs").getFromMeta(b("bs_caml_option").valFromOption(a)):d.folder}za.includes(f)&&((b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").LOG_MESSAGE))&&d.is_unread&&ya(c,f,e));return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]]}var nb=function(a,b){delete a[b];return 0};function ob(a,c){__p&&__p();Object.keys(c).forEach(function(e){__p&&__p();var d=b("bs_js_dict").get(c,e);if(d!==void 0){d=d;var f=d[0],g=i(f.reduce(function(d,e){var c=b("bs_belt_Map").get(a,e);if(c!==void 0)return b("bs_belt_Map").set(d,e,b("bs_caml_option").valFromOption(c));else return d},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Object.keys(g).length===f.length){b("bs_curry")._2(nb,c,e);return b("bs_curry")._1(d[1],g)}else return 0}else return 0});return 0}function pb(c,a,d,e,f){__p&&__p();d!==0&&sa(c,a.thread_id,f,d);if(a.timestamp===0){b("ChatReliabilityInstrumentation").logERROR("thread timestamp is 0");e.add(a.thread_id);return}else{d=a.unread_count===0;if(d===f)return;else{s(c,a.thread_id);return{unread_count:f?0:1,unread_mentions_count:0}}}}function qb(a,c,d,e,f){f=xa(a,f,c,d);a=a[12][c];c=b("bs_js_dict").get(a,d);c=c!==void 0?b("bs_caml_option").valFromOption(c).reachedEnd:!1;a[d]={reachedEnd:e[0]?e[0]:c,threadlist:f[0],existingIDs:f[1]};return 0}function rb(a,c,d,e){__p&&__p();var f=b("bs_belt_Array").make(e.length,[]),g=[!1];d.forEach(function(d){__p&&__p();d.thread_ids.forEach(function(c){__p&&__p();var h=b("bs_belt_Map").get(a[7],c);if(h!==void 0){h=u(b("bs_caml_option").valFromOption(h));for(var g=0,d=e.length-1|0;g<=d;++g){var i=h.find(function(a){return function(c){return c===b("bs_caml_array").caml_array_get(e,a)}}(g));(i===void 0?void 0:b("bs_caml_option").some(i))!==void 0&&b("bs_caml_array").caml_array_get(f,g).push(c)}return 0}else return 0});d=d.limit;var h=e.find(function(a){return a===b("MercuryFilters.bs").all});h=h===void 0?void 0:b("bs_caml_option").some(h);for(var i=0,c=f.length-1|0;i<=c;++i)h===void 0&&b("bs_caml_array").caml_array_get(f,i).length<d?g[0]=!0:b("bs_caml_array").caml_array_get(e,i)===b("MercuryFilters.bs").all&&b("bs_caml_array").caml_array_get(f,i).length<d&&(g[0]=!0);return 0});for(var d=0,h=e.length-1|0;d<=h;++d)qb(a,c,b("bs_caml_array").caml_array_get(e,d),g,b("bs_caml_array").caml_array_get(f,d));return 0}function A(d,a){var e;if(a.is_archived)e=b("MessagingTag").ACTION_ARCHIVED;else{var c=a.thread_type;e=c==null||c!==b("MessagingThreadType").MARKETPLACE?a.folder:b("MessagingTag").MARKETPLACE_FOLDER}c=b("bs_js_dict").get(d[12],e);if(c!==void 0)return e}function sb(a,c){__p&&__p();var d={};oa.forEach(function(a){var b={};na.forEach(function(a){b[a]=[];return 0});d[a]=b;return 0});c.forEach(function(c){__p&&__p();var e=b("bs_belt_Map").get(a[7],c.thread_id);if(e!==void 0){var f=b("bs_caml_option").valFromOption(e);e=A(a,f);if(e!==void 0){var g=e;u(f).forEach(function(a){if(f.timestamp!==0){d[g][a].push(c.thread_id);return 0}else return 0});return 0}else return 0}else return 0});oa.forEach(function(b){na.forEach(function(c){var e=d[b][c];xa(a,e,b,c);return 0});return 0});return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}function tb(a){__p&&__p();b("bs_belt_Map").map(a[7],function(c){__p&&__p();c=b("bs_belt_Map").get(a[7],c.thread_id);if(c!==void 0){c=b("bs_caml_option").valFromOption(c);if(b("bs_caml_option").nullable_to_opt(c.thread_type)===b("MessagingThreadType").MARKETPLACE){c=b("ImmutableObject").set(c,{folder:"marketplace_folder"});sb(a,[c]);return 0}else return 0}else return 0});return 0}function ub(c,a,d){__p&&__p();var e=function(a){return a.timestamp>(d?b("bs_caml_primitive").caml_float_max(c[18],a.last_read_timestamp):c[18])},f=function(a){var d;return(d=b("bs_belt_Option")).mapWithDefault(d.flatMap(d.map(d.map(b("bs_caml_option").nullable_to_opt(c[15].get(a.thread_id)),function(a){return b("bs_caml_array").caml_array_get(a[1],0)}),function(a){return b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c[10].get(a)),a)}),function(a){return b("bs_caml_option").nullable_to_opt(c[9].get(a))}),!1,function(a){return a.author===b("MercuryIDs").getParticipantIDFromUserID(c[0])})},g=function(a,c){if(e(a)&&!b("MercuryThreadInfo").isMuted(a)&&!f(a))return c+1|0;else return c};return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c[12],b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){__p&&__p();d=d.threadlist;if(d.length!==0)return d.reduce(function(a,d){d=b("bs_belt_Map").get(c[7],d);if(d!==void 0)return g(b("bs_caml_option").valFromOption(d),a);else return a},0);else if(b("bs_belt_Map").isEmpty(c[7]))return a[7][0];else return b("bs_belt_Map").reduce(c[7],0,function(d,e,a){e=A(c,a);if(e!==void 0&&e===b("MessagingTag").INBOX)return g(a,d);else return d})}),a[7][0])}function B(c,a){__p&&__p();return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c[12],b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){__p&&__p();if(d.threadlist.length===0)if(b("bs_belt_Map").isEmpty(c[7]))return a[7][0];else return b("bs_belt_Map").reduce(c[7],0,function(e,f,a){__p&&__p();var d=A(c,a);if(d!==void 0&&d===b("MessagingTag").INBOX&&a.timestamp>c[18]&&!b("MercuryThreadInfo").isMuted(a)){d=b("bs_js_dict").get(c[16],b("MessagingTag").INBOX);if(d!==void 0){a=b("bs_caml_option").valFromOption(d).has(f);if(a)return e+1|0;else return e}else return e}else return e});else return d.threadlist.reduce(function(d,e){__p&&__p();var a=b("bs_belt_Map").get(c[7],e);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);if(a.timestamp>c[18]&&!b("MercuryThreadInfo").isMuted(a)){a=b("bs_js_dict").get(c[16],b("MessagingTag").INBOX);if(a!==void 0){a=b("bs_caml_option").valFromOption(a).has(e);if(a)return d+1|0;else return d}else return d}else return d}else return d},0)}),a[7][0])}function vb(c,a,d){if(d===b("MessagingTag").PENDING)return[c[0],c[1],c[2],c[3],c[4],0,c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]];else{if(b("gkx")("969964")){d=b("MercuryThreadInformer").getForFBID(c[0]);d.updatedUnseenTimestamp()}return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],a]}}function C(a,c,d){__p&&__p();var e=[];d=b("bs_array").fold_left(function(g,k){__p&&__p();switch(k.tag|0){case 0:e.push(k[0].tag|0);break;case 1:case 2:break}switch(k.tag|0){case 0:var f=k[0];if(typeof f==="number"){var l=g,m=a;m[0][0]={};m[1][0]=m[1][0];m[6][0]={};m[2].clear();b("bs_belt_Map").keysToArray(l[7]).forEach(function(a){return qa(l[0],a)});return[l[0],l[1],b("bs_belt_MapString").empty,l[3],l[4],l[5],l[6],b("bs_belt_Map").make(b("ThreadId.bs")),new Set(),new Map(),new Map(),l[11],pa(0),l[13],l[14],new Map(),l[16],l[17],l[18]]}else switch(f.tag|0){case 0:m=g;var ba=f[0],ca=[!1],da=[m[1]];Object.keys(ba).forEach(function(a){var c=ba[a],d=b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(da[0],a),0);if(c>d){ca[0]=!0;da[0]=b("bs_belt_MapString").set(da[0],a,c);return 0}else return 0});if(ca[0])return[m[0],da[0],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];else return m;case 1:return ia(g,f[0],[]);case 2:m=g;var n=f[0],o=f[1];o=o.reduce(b("bs_belt_Set").remove,n.reduce(b("bs_belt_Set").add,m[4]));if(o===m[4])return m;else return[m[0],m[1],m[2],m[3],o,m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];case 3:n=g;o=f[0];m=o.reduce(function(c,d){var a=d.is_messenger_ignored;if(a==null)return c;else if(a)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid))},n[3]);if(m===n[3])return n;else return[n[0],n[1],n[2],m,n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];case 4:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("SetInitialPendingFolderUnseenCount");o=g;m=f[0];return[o[0],o[1],o[2],o[3],o[4],m,o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];case 5:n=g;m=f[0];o=la(n[0],m);if(o==null)return n;else{var p=b("FBID.bs").ofString(m.from.toString());if(p!==void 0){b("MessengerPersonas.bs").addPersona(m.persona);var q=m.persona;p=q==null?b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(p)):b("MercuryIDs").getParticipantIDFromUserID(q.id);if(m.st===b("TypingStates").TYPING){q=b("bs_belt_MapString").get(n[6],o);if(q!==void 0)return[n[0],n[1],n[2],n[3],n[4],n[5],b("bs_belt_MapString").set(n[6],o,b("bs_belt_Map").set(b("bs_caml_option").valFromOption(q),p,Date.now())),n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];else{q=b("bs_belt_Map").set(b("bs_belt_Map").make(b("ParticipantId.bs")),p,Date.now());return[n[0],n[1],n[2],n[3],n[4],n[5],b("bs_belt_MapString").set(n[6],o,q),n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]]}}else if(m.st===b("TypingStates").INACTIVE){q=ka(n[6],o,p);if(q!==n[6])return[n[0],n[1],n[2],n[3],n[4],n[5],q,n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]];else return n}else return n}else return n}case 6:m=g;var ea=f[0],fa=[!1],ga=[m[2]];Object.keys(ea).forEach(function(c){__p&&__p();Object.keys(ea[c]).forEach(function(d){var a=b("bs_belt_MapString").get(ga[0],c);a=a!==void 0?b("bs_caml_option").valFromOption(a):b("immutable").OrderedMap();var e=a.get(d),f=ea[c][d];if(!(e==null)&&f.watermark<=e.watermark)return 0;fa[0]=!0;ga[0]=b("bs_belt_MapString").set(ga[0],c,a.set(d,f));return 0});var a=b("bs_belt_MapString").get(ga[0],c);if(a!==void 0){fa[0]=!0;ga[0]=b("bs_belt_MapString").set(ga[0],c,b("bs_caml_option").valFromOption(a).sort(function(a,c){return b("bs_caml_primitive").caml_float_compare(a.watermark,c.watermark)}));return 0}else return 0});if(fa[0])return[m[0],m[1],ga[0],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]];else return m;case 7:var r=g;o=a;p=f[0];if(p.length!==0){q=r[7];n=p.reduce(function(c,a){return b("bs_belt_Map").set(c,a.thread_id,new(b("ImmutableObject"))(a))},q);ob(n,o[0][0]);p.forEach(function(a){return s(r[0],a.thread_id)});return[r[0],r[1],r[2],r[3],r[4],r[5],r[6],n,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15],r[16],r[17],r[18]]}else return r;case 8:m=g;q=f[0];if(q.length!==0){var sa=m[8],ta=b("MercuryServerRequests").getForFBID(m[0]);q.forEach(function(a){__p&&__p();var b=a.thread_id;if(sa.has(b)){sa["delete"](b);if(a.unread_count>0){ta.changeThreadReadStatus(b,!0,null,null,null,null);return 0}else return 0}else return 0});return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],sa,m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m;case 9:var u=g,Ca=f[0];b("qex")._("998180")&&b("MessengerEnvironment").messengerdotcom&&tb(u);oa.forEach(function(a){__p&&__p();na.forEach(function(d){__p&&__p();var c=u,e=Ca,f=a,g=d;d=e.filter(function(c){var a=c.filter;a=a==null?b("MercuryFilters.bs").all:a;c=c.folder;c=c==null?f===b("MessagingTag").INBOX:c===f;if(c)return a===g;else return!1});if(!b("gkx")("1275193")||f!==b("MessagingTag").INBOX&&f!==b("MessagingTag").ACTION_ARCHIVED&&f!==b("MessagingTag").PENDING||g===b("MercuryFilters.bs").groups){var h=[],i=[!1];d.forEach(function(a){a.thread_ids.forEach(function(a){h.push(a);return 0});var b=a.limit;if(a.thread_ids.length<b){i[0]=!0;return 0}else return 0});return qb(c,f,g,i,h)}else if(g===b("MercuryFilters.bs").all){return rb(c,f,d,[(e=b("MercuryFilters.bs")).all,e.unread,e.named,e.unnamed])}else return rb(c,f,d,[b("MercuryFilters.bs").all,g])});return 0});return[u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],u[11],u[12],u[13],u[14],u[15],u[16],u[17],u[18]];case 10:return sb(g,f[0]);case 11:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdatePinnedThreads");var v=g,Ga=a;o=f[0];if(o.length!==0){o.forEach(function(a){if(Ga[5].has(a))return 0;else{v[13].push(a);Ga[5].add(a);return 0}});p=b("MercuryThreadInformer").getForFBID(v[0]);p.updatedThreadlist();return[v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15],v[16],v[17],v[18]]}else return v;case 12:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnSubscribeStatusUpdate");n=g;q=f[0];var Ha=f[1];return t(function(a){return a.page_unsubscribe_status!==Ha},n,q,{page_unsubscribe_status:Ha});case 13:m=g;o=f[0];p=f[1];n=f[2];return t(void 0,m,o,{can_reply:p,cannot_reply_reason:n});case 14:q=g;m=f[0];o=f[1];p=b("bs_belt_Map").get(q[7],m);if(p!==void 0){n=Object.assign({},b("bs_caml_option").valFromOption(p));va(b("MercuryIDs").getParticipantIDFromUserID(q[0]),n,o);return t(void 0,q,m,n)}else return q;case 15:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFlag");p=g;o=f[0];m=f[1];n=b("bs_belt_Map").get(p[7],o);if(n!==void 0){q=b("bs_caml_option").valFromOption(n);n=q.page_thread_info;q=b("ImmutableObject").set(q,{page_thread_info:Object.assign(n==null?{}:n,{flagged:m})});n=b("bs_belt_Map").set(p[7],o,q);s(p[0],o);return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],n,p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]]}else return p;case 16:m=g;q=f[0];return t(function(a){return b("MessageRequestUtils").isMessageRequest(a)},m,q,{folder:b("MessagingTag").INBOX});case 17:o=g;n=f[0];p=f[1];return t(void 0,o,n,{custom_like_icon:p});case 18:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PromoteGroupAdmins");m=g;q=f[0];o=f[1];n=b("bs_belt_Map").get(m[7],q);if(n!==void 0){p=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(p.admins));p=b("ImmutableObject").set(p,{admins:b("bs_array").fold_left(function(a,b){a[b.admin_fbid]=b.admin_type;return a},n,o)});n=b("bs_belt_Map").set(m[7],q,p);s(m[0],q);return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],n,m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m;case 19:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("RemoveGroupAdmins");o=g;p=f[0];q=f[1];n=b("bs_belt_Map").get(o[7],p);if(n!==void 0){m=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(m.admins));m=b("ImmutableObject").set(m,{admins:b("bs_array").fold_left(function(d,c){var a=b("bs_js_dict").get(d,c);a!==void 0&&b("bs_curry")._2(ja,d,c);return d},n,q)});n=b("bs_belt_Map").set(o[7],p,m);s(o[0],p);return[o[0],o[1],o[2],o[3],o[4],o[5],o[6],n,o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]]}else return o;case 20:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("JoinableMode");q=g;m=f[0];p=f[1];return t(void 0,q,m,{joinable_mode:p});case 21:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalMode");n=g;o=f[0];q=f[1];return t(void 0,n,o,{approval_mode:q});case 22:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalQueue");m=g;p=f[0];n=f[1];o=f[2];var Ia=f[3],Ja=f[4];q=b("bs_belt_Map").get(m[7],p);if(q!==void 0){q=b("bs_caml_option").valFromOption(q);var w=q.group_approval_queue;q={approval_queue_ids:q.approval_queue_ids.slice(),group_approval_queue:w==null?null:w.slice()};n==null||q.approval_queue_ids.indexOf(n)===-1&&Object.assign(q,{approval_queue_ids:q.approval_queue_ids.concat([n])});if(!(o==null)){w=q.group_approval_queue;w==null?Object.assign(q,{group_approval_queue:[o]}):w.map(function(a){return a.requester.id}).indexOf(o.requester.id)===-1&&Object.assign(q,{group_approval_queue:w.concat([o])})}Ia==null||Object.assign(q,{approval_queue_ids:q.approval_queue_ids.filter(function(a){return b("bs_caml_obj").caml_notequal(a,Ia)})});if(!(Ja==null)){n=q.group_approval_queue;Object.assign(q,{group_approval_queue:(n==null?[]:n).filter(function(a){return a.requester.id!==Ja})})}return t(void 0,m,p,q)}else return m;case 23:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("IsPinProtected");w=g;o=f[0];n=f[1];return t(void 0,w,o,{is_pin_protected:n});case 24:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateRtcCallData");p=g;q=f[0];m=f[1];w=f[2];o=f[3];n=b("bs_belt_Map").get(p[7],q);if(n!==void 0){if(m==null){n=b("bs_caml_option").valFromOption(n).rtc_call_data;n=n==null?void 0:m}else n=m;return t(void 0,p,q,{rtc_call_data:new(b("ImmutableObject"))({call_state:w,server_info_data:o,initiator_fbid:n})})}else return p;case 25:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommStatus");m=g;q=f[0];w=f[1];return t(void 0,m,q,{comm_status:w});case 26:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommItemOwner");o=g;n=f[0];p=f[1];m=f[2];q=f[3];w=p==null?{nodes:[]}:{nodes:[{admin:{id:p,name:m,profile_picture:{uri:q}}}]};t(void 0,o,n,{comm_item_owners:w});if(p==null)return t(void 0,o,n,{thread_associated_page_admin:null});else return t(void 0,o,n,{thread_associated_page_admin:{id:p,name:m,profile_picture:{uri:q}}});case 27:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("EventRsvpChanged");w=g;o=f[0];var Ka=f[1];n=f[2];p=b("bs_belt_Map").get(w[7],o);if(p!==void 0){m=b("bs_caml_option").valFromOption(p).participants_event_status;q=(m==null?[]:m).filter(function(a){return b("bs_caml_obj").caml_notequal(a.participant_id,Ka)});q.push({participant_id:Ka,event_status:n});return t(void 0,w,o,{participants_event_status:q})}else return w;case 28:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncStatusChanged");p=g;m=f[0];n=f[1];o=f[2];return!(o==null)&&b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").OPT_IN)?t(void 0,p,m,{groups_sync_status:n}):t(void 0,p,m,{groups_sync_status:n,work_associated_group:null});case 29:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncMetadataUpdate");q=g;w=f[0];o=f[1];p=f[2];m=f[3];if(o==null)return t(void 0,q,w,{work_associated_group:null});else if(b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").OPT_IN)){n=new(h||(h=b("URI")))(document.URL);var x=n.getDomain();x=b("XGroupsController").getURIBuilder().setString("idorvanity",p).getURI().setDomain(x==null?"":x.replace("messenger.com","facebook.com")).setPort(n.getPort()).setProtocol("https");return t(void 0,q,w,{work_associated_group:{id:p,url:x.toString(),group_saves:{count:0},group_events:{count:0}}})}else if(b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").UPDATE_EMOJI))return t(void 0,q,w,{work_associated_group:{id:p,group_icon:{emoji_codepoints:m}}});else return t(void 0,q,w,{work_associated_group:null});case 30:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DescriptionChanged");n=g;x=f[0];o=f[1];return t(void 0,n,x,{description:o});case 31:return wa(g,f[0],f[1]);case 32:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateJoinableLink");p=g;m=f[0];q=f[1];return t(void 0,p,m,{joinable_link:q});case 33:var y=g,Ua=f[0];w=b("bs_belt_Map").toArray(y[7]).reduce(function(c,d){var a=d[1];d=d[0];if(a.folder===Ua){s(y[0],d);return b("bs_belt_Map").set(c,d,b("ImmutableObject").set(a,{unread_count:0,unread_mentions_count:0}))}else return c},y[7]);y[16][Ua]=new Set();n=b("MercuryThreadInformer").getForFBID(y[0]);n.updatedUnreadState();return[y[0],y[1],y[2],y[3],y[4],y[5],y[6],w,y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15],y[16],y[17],y[18]];case 34:var z=g,Va=f[0];b("gkx")("1199097")&&(b("ChatReliabilityInstrumentation").logDELETE_THREAD(Va),b("LogHistory").getInstance("messenger_state").debug("delete_thread",Va));x=b("bs_belt_Map").remove(z[7],Va);z[15]["delete"](Va);z[9].forEach(function(a,c,d){__p&&__p();if(b("bs_caml_obj").caml_equal(a.thread_id,Va)){z[9]["delete"](a.message_id);c=a.offline_threading_id;if(!(c==null)){d=z[10].get(c);d==null||(z[9]["delete"](d),z[10]["delete"](c))}z[10]["delete"](a.message_id);return 0}else return 0});qa(z[0],Va);return[z[0],z[1],z[2],z[3],z[4],z[5],z[6],x,z[8],z[9],z[10],z[11],z[12],z[13],z[14],z[15],z[16],z[17],z[18]];case 35:o=f[0];return Wa(g,a,[o.message_id,o,f[1]]);case 36:p=g;m=[f[0],f[1],f[2]];var Xa=m[2];q=m[1];var jb=m[0];if(q.length!==0){n=Za(p,[jb,q,Xa]);w=0;Xa!==void 0&&b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(Xa),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||(w=1);w===1&&b("MercuryServerRequests").getForFBID(n[0]).deleteMessages(jb,q);return b("bs_belt_Array").reduce(q,n,function(d,e){__p&&__p();var c=Ra(d,e),a=b("bs_belt_Map").get(d[7],jb);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);a=b("ImmutableObject").set(b("ImmutableObject").set(a,$a(d,jb)),{message_count:a.message_count-1|0});a=b("bs_belt_Map").set(d[7],jb,a);s(d[0],jb);a=[d[0],d[1],d[2],d[3],d[4],d[5],d[6],a,d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15],d[16],d[17],d[18]]}else a=d;if(c!==void 0){d=b("bs_caml_option").valFromOption(c);ab(b("bs_caml_option").some(jb),d);Oa(a[0],jb,e,Xa,d.attachments)}return a})}else return p;case 37:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFolder");return Fa(g,f[0],f[1],1);case 38:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeMuteSettings");x=g;o=f[0];m=f[1];w=b("bs_belt_Map").get(x[7],o);if(w!==void 0){q=b("bs_caml_option").valFromOption(w);var kb;switch(m.tag|0){case 0:kb=b("ImmutableObject").set(q,{reactions_mute_mode:m[0]?1:0});break;case 1:kb=b("ImmutableObject").set(q,{mentions_mute_mode:m[0]?1:0});break;case 2:n=m[0];p=n===0;kb=b("ImmutableObject").set(q,{mute_until:p?void 0:n});break}w=b("bs_belt_Map").set(x[7],o,kb);s(x[0],o);return[x[0],x[1],x[2],x[3],x[4],x[5],x[6],w,x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15],x[16],x[17],x[18]]}else return x;case 39:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeArchivedStatus");m=g;q=f[0];p=f[1];n=b("bs_belt_Map").get(m[7],q);if(n!==void 0){o=b("bs_caml_option").valFromOption(n);if(o.is_archived!==p){w=b("MessengerFolders.bs").getFromMeta(o);x=o.comm_status;n=x==null?b("ImmutableObject").set(o,{is_archived:p}):b("ImmutableObject").set(o,{is_archived:p,comm_status:p?b("PageCommItemStatus").DONE:b("PageCommItemStatus").TODO});x=b("bs_belt_Map").set(m[7],q,n);Ba(m,n,w);Ea(m,n);s(m[0],q);return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],x,m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15],m[16],m[17],m[18]]}else return m}else return m;case 40:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePageFollowUpStatus");o=g;p=f[0];w=f[1];n=b("bs_belt_Map").get(o[7],p);if(n!==void 0){q=b("bs_caml_option").valFromOption(n);if(q.is_page_follow_up!==w){x=b("ImmutableObject").set(q,{is_page_follow_up:w});m=b("bs_belt_Map").set(o[7],p,x);s(o[0],p);return[o[0],o[1],o[2],o[3],o[4],o[5],o[6],m,o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]]}else return o}else return o;case 41:n=g;q=f[0];w=f[1];x=f[2];p=f[3];m=f[4];o=b("bs_belt_Map").get(n[7],q);if(o!==void 0){o=b("bs_caml_option").valFromOption(o);x=pb(n[0],o,x,n[8],w);x=x!==void 0&&o.last_message_timestamp>o.last_read_timestamp?b("bs_caml_option").some(Object.assign(b("bs_caml_option").valFromOption(x),{last_read_timestamp:o.last_message_timestamp})):x;if(x!==void 0){x=b("ImmutableObject").set(o,b("bs_caml_option").valFromOption(x));var A=b("bs_belt_Map").set(n[7],q,x);if(p){p=!o.read_only&&o.folder===b("MessagingTag").INBOX;var B=b("MercuryServerRequests").getForFBID(n[0]);B.changeThreadReadStatus(x.thread_id,w,m,x.last_read_timestamp,p,x.last_message_type)}B=A}else B=n[7];m=b("MessengerFolders.bs").getFromMeta(o);w?(ua(n,[q],m,b("MercuryFilters.bs").unread),Aa(n,m,b("bs_caml_option").some(q))):(b("gkx")("1275193")?Da(n,m,q):xa(n,[q],m,b("MercuryFilters.bs").unread),ya(n,m,b("bs_caml_option").some(q)));return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],B,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18]]}else return n;case 42:var C=g,wb=f[0];p=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(C[15].get(wb)),function(a){return[a[0],[]]}),[0,[]]);C[15].set(wb,p);x=b("bs_belt_Option").map(b("bs_belt_Map").get(C[7],wb),function(a){return b("ImmutableObject").set(a,{message_count:0})});if(x!==void 0){var xb=b("bs_caml_option").valFromOption(x);A=b("bs_belt_Map").set(C[7],wb,xb);na.forEach(function(a){return ua(C,[wb],b("MessengerFolders.bs").getFromMeta(xb),a)});o=A}else o=C[7];za.forEach(function(a){a=b("bs_js_dict").get(C[16],a);if(a!==void 0){b("bs_caml_option").valFromOption(a)["delete"](wb);return 0}else return 0});ra(C[0],wb);return[C[0],C[1],C[2],C[3],C[4],C[5],C[6],o,C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18]];case 43:w=g;m=a;q=[f[0],f[1],f[2]];B=Ya(w,[q[0],q[1]]);n=B.thread_id;p=Za(w,[n,[B.message_id],q[2]]);x=m[2].get(n);x==null||m[2].set(n,Math.max(0,x-1|0));return p;case 44:A=g;o=[f[0],f[1]];w=Ya(A,[o[0],o[1]]);b("MercuryServerRequests").getForFBID(A[0]).sendNewMessage(Object.assign(w,{preview_attachments:void 0}));return A;case 45:B=g;q=[f[0],f[1],f[2],f[3]];m=q[2];n=q[1];x=q[0];p=Ra(B,x);if(p!==void 0){o=b("bs_caml_option").valFromOption(p);w=b("bs_js_dict").map(function(a){return a},b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(o.reactions),{}));n!==void 0?w[m]=n:b("bs_curry")._2(Qa,w,m);A=Object.assign(Object.assign({},o),{reactions:w});p=o.thread_id;p==null||Ma(B[0],p,x,q[3]);return Ta(B,[x,A])}else return B;case 46:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontageDirectExpire");n=g;m=f[0];w=Ra(n,m);if(w!==void 0){o=b("bs_caml_option").valFromOption(w);p=o.attachments;if(p==null||p.length===0)return n;else{q=b("bs_caml_array").caml_array_get(p,0);x=q.share;if(x==null)return n;else{A=x.target;if(A==null)return n;else{B=A.message_state;if(B==null)return n;else{w=Object.assign(Object.assign({},o),{attachments:b("bs_caml_array").caml_array_set(b("bs_array").copy(p),0,Object.assign(Object.assign({},q),{share:Object.assign(Object.assign({},x),{target:Object.assign(Object.assign({},A),{message_state:"EXPIRED"})})}))});return Ta(n,[m,w])}}}}}else return n;case 47:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("LiveLocationUpdate");B=g;o=[f[0],f[1],f[2]];p=o[0];q=Ra(B,p);if(q!==void 0){x=b("bs_caml_option").valFromOption(q);A=x.attachments;if(A==null||A.length===0)return B;else{m=b("bs_caml_array").caml_array_get(A,0);w=m.share;if(w==null)return B;else{n=w.target;if(n==null)return B;else{q=b("bs_array").copy(A);b("bs_caml_array").caml_array_set(q,0,Object.assign(Object.assign({},m),{share:Object.assign(Object.assign({},w),{target:Object.assign(Object.assign({},o[1]),{live_location_id:n.live_location_id})})}));A=Object.assign(Object.assign({},x),{attachments:q});m=x.thread_id;m==null||Ma(B[0],m,p,o[2]);return Ta(B,[p,A])}}}}else return B;case 48:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ReplaceMessage");w=g;n=f[0];q=f[1];var yb=n.replaced_message_id;if(yb==null)return w;else{x=Ra(w,yb);if(x!==void 0){m=n.message_id;o={timestamp:n.timestamp};p=b("bs_caml_option").nullable_to_opt(n.status);p!==void 0&&(o.status=b("bs_caml_option").valFromOption(p));A=b("bs_caml_option").nullable_to_opt(n.log_message_data);A!==void 0&&(o.log_message_data=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(n.meta_ranges);B!==void 0&&(o.meta_ranges=b("bs_caml_option").valFromOption(B));p=b("bs_caml_option").nullable_to_opt(n.ranges);p!==void 0&&(o.ranges=b("bs_caml_option").valFromOption(p));A=b("bs_caml_option").nullable_to_opt(n.raw_attachments);A!==void 0&&(o.raw_attachments=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(n.attachments);B!==void 0&&(o.attachments=b("bs_caml_option").valFromOption(B));p=b("bs_caml_option").nullable_to_opt(n.body);p!==void 0&&(o.body=b("bs_caml_option").valFromOption(p));A=b("bs_caml_option").nullable_to_opt(n.platform_xmd);A!==void 0&&(o.platform_xmd=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(n.profile_ranges);B!==void 0&&(o.profile_ranges=b("bs_caml_option").valFromOption(B));p=o;A=Object.assign(Object.assign({},b("bs_caml_option").valFromOption(x)),p);b("MercuryMessageIDs.bs").addServerID(m,m);var D=Ta(w,[m,A]);if(m!==yb){D[9]["delete"](yb);D[10].set(yb,m);B=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(n.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(D[15].get(a))});o=n.thread_id;if(B!==void 0&&!(o==null)){x=B;p=Sa(D,[m].concat(x[1].filter(function(a){return a!==yb})));D[15].set(o,[x[0],p])}}A=n.message_id;B=n.thread_id;B==null||(Ma(D[0],B,yb,q),Ma(D[0],B,A,q));return[D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18]]}else return w}case 49:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateLocalTitanMessagesCount");m=g;o=a;x=[f[0],f[1]];p=x[0];n=Ra(m,x[1]);if(n!==void 0&&b("MessengerMessage.bs").isTitanMessage(b("bs_caml_option").valFromOption(n))){B=o[2].get(p);B==null?o[2].set(p,1):o[2].set(p,1+B|0)}return m;case 50:return db(g,a,f[0],f[1]);case 51:A=g;q=a;w=f[0];x=f[1];n=f[2];o=hb(A,w,x,n==null?void 0:b("bs_caml_option").some(n));fb(o[0],x,w,function(a,b,c){a.informNewMessage(b,c);return 0});p=o[0];if(w.folder===b("MessagingTag").PENDING&&b("bs_caml_obj").caml_equal(x,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)))B=[o[0],o[1],o[2],o[3],o[4],o[5]+1|0,o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];else if(w.folder===b("MessagingTag").INBOX){m=w.thread_id;B=m==null?o:Fa(o,m,w.folder,0)}else{A=w.thread_id;if(A==null)B=o;else{m=lb(o[0],o[7],w,n);if(m!==void 0){n=b("bs_caml_option").valFromOption(m);m=o[0];var E=o[1],F=o[2],G=o[3],H=o[4],I=o[5],J=o[6],K=b("bs_belt_Map").set(o[7],n.thread_id,n),L=o[8],M=o[9],N=o[10],O=o[11],P=o[12],Q=o[13],R=o[14],Ab=o[15],S=o[16],T=o[17],U=o[18];m=[m,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,Ab,S,T,U];if(b("bs_caml_obj").caml_equal(x,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))){E=w.offline_threading_id;E==null?Object.assign(w,{folder:n.folder}):b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(N.get(E)),E)?Object.assign(w,{client_message_id:w.offline_threading_id,status:b("MercuryActionStatus").SUCCESS,action_type:b("MercuryActionType").SEND_MESSAGE}):Object.assign(w,{folder:n.folder})}Ea(m,n);F=Object.assign({},n);G=w.offline_threading_id;if(!(G==null)&&G!==w.message_id){Object.assign(F,{last_message_timestamp:w.timestamp});H=w.comm_status;H==null||Object.assign(F,{last_message_id:w.message_id})}I=w.comm_status;J=F.comm_status;I==null||!(J==null)&&b("bs_caml_obj").caml_notequal(J,b("PageCommItemStatus").FOLLOW_UP)&&Object.assign(F,{comm_status:I});K=w.creator_info;K==null||b("bs_caml_obj").caml_equal(K.pageID,p)&&Object.assign(F,{folder:w.folder});L=w.author;L==null||gb(F,L);B=t(void 0,m,A,F)}else B=o}}M=eb(B,q,w,x);O=mb(M,w);P=O;Q=w;R=b("bs_caml_obj").caml_notequal(Q.author,b("MercuryViewer").getID());Ab=Q.thread_id;S=Q.author;if(R&&!(Ab==null||S==null)){T=ka(P[6],Ab,S);if(T!==P[6])return[P[0],P[1],P[2],P[3],P[4],P[5],T,P[7],P[8],P[9],P[10],P[11],P[12],P[13],P[14],P[15],P[16],P[17],P[18]];else return P}else return P;case 52:U=g;N=a;E=f[0];n=f[1];G=f[2];H=b("bs_caml_obj").caml_notequal(G==null?void 0:b("bs_caml_option").some(G),!1);J=b("bs_caml_obj").caml_equal(G==null?void 0:b("bs_caml_option").some(G),!0);I=U[0];K=b("MercuryIDs").getParticipantIDFromUserID(I);p=eb(U,N,E,n);fb(p[0],n,E,function(a,b,c){a.informNewLogMessage(b,c);return 0});L=hb(p,E,n,G==null?void 0:b("bs_caml_option").some(G));m=E.thread_id;if(m==null)A=L;else{F=b("bs_belt_Map").get(L[7],m);if(F!==void 0){o=Object.assign({},b("bs_caml_option").valFromOption(F));Ea(L,o);o.last_message_timestamp<E.timestamp&&Object.assign(o,{last_message_timestamp:E.timestamp});if(E.timestamp>=o.timestamp||b("gkx")("1183082")){B=E.log_message_type;if(!(B==null))if(b("bs_caml_obj").caml_equal(B,b("MercuryLogMessageType").SUBSCRIBE)&&!J){q=E.log_message_data;if(q==null)x=[];else{M=q.added_participants;x=M==null?[]:M}va(K,o,x);s(I,m)}else if(b("bs_caml_obj").caml_equal(B,b("MercuryLogMessageType").UNSUBSCRIBE)&&!J){O=E.log_message_data;if(O==null)w=[];else{Q=O.removed_participants;w=Q==null?[]:Q}ib(K,o,w);s(I,m)}else if(b("bs_caml_obj").caml_equal(B,b("MercuryLogMessageType").THREAD_IMAGE)){if(!H){R=E.log_message_data;if(R==null)Ab=null;else{S=R.image;Ab=S==null?null:S.preview_url}Object.assign(o,{image_src:Ab})}}else if(b("bs_caml_obj").caml_equal(B,b("MercuryLogMessageType").THREAD_NAME)){T=E.log_message_data;if(!(T==null)){P=T.name;!(P==null)&&o.name===P||s(I,m);Object.assign(o,{name:T.name})}}else b("bs_caml_obj").caml_equal(B,b("MercuryLogMessageType").GENERIC_ADMIN_TEXT)&&La(I,o,E,m)}A=t(void 0,L,m,o)}else A=L}return mb(A,E);case 53:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PinMessage");if(b("gkx")("1179386")){U=g;N=f[0];var Bb=f[1];p=b("bs_belt_Map").get(U[7],N);if(p!==void 0&&!(Bb==null)){n=b("bs_caml_option").valFromOption(p);G=n.pinned_messages;if(G==null)F=[Bb.message];else if(G.findIndex(function(a){return a.message_id===Bb.message.message_id})===-1){q=G.slice();q.unshift(Bb.message);F=q}else F=void 0;if(F!==void 0){M=b("ImmutableObject").set(n,{pinned_messages:b("bs_belt_Option").getExn(F)});x=b("bs_belt_Map").set(U[7],N,M);s(U[0],N);J=x}else J=U[7]}else J=U[7];return[U[0],U[1],U[2],U[3],U[4],U[5],U[6],J,U[8],U[9],U[10],U[11],U[12],U[13],U[14],U[15],U[16],U[17],U[18]]}else return g;case 54:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnpinMessage");if(b("gkx")("1179386")){O=g;Q=f[0];var Cb=f[1];K=b("bs_belt_Map").get(O[7],Q);if(K!==void 0&&!(Cb==null)){w=b("bs_caml_option").valFromOption(K);H=w.pinned_messages;R=H==null?void 0:H.filter(function(a){return a.message_id!==Cb.message_id});if(R!==void 0){S=b("ImmutableObject").set(w,{pinned_messages:b("bs_belt_Option").getExn(R)});Ab=b("bs_belt_Map").set(O[7],Q,S);s(O[0],Q);P=Ab}else P=O[7]}else P=O[7];return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],P,O[8],O[9],O[10],O[11],O[12],O[13],O[14],O[15],O[16],O[17],O[18]]}else return g;case 55:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePinnedStatus");T=g;B=a;I=f[0];m=f[1];o=f[2];L=b("bs_belt_Map").get(T[7],I);A=!1;if(m&&!B[5].has(I))T[13].push(I),B[5].add(I),A=!0;else if(!m&&B[5].has(I)){E=T[13].indexOf(I);E>-1&&T[13].splice(E,1);B[5]["delete"](I);A=!0}if(L!==void 0){p=b("bs_caml_option").valFromOption(L);G=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(p.thread_pin_timestamp),0);if(p.is_pinned!==m||G!==o){q=b("ImmutableObject").set(p,{is_pinned:m,thread_pin_timestamp:o});n=b("bs_belt_Map").set(T[7],I,q);s(T[0],I);A=!0;F=n}else F=T[7]}else F=T[7];if(A)return[T[0],T[1],T[2],T[3],T[4],T[5],T[6],F,T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15],T[16],T[17],T[18]];else return T;case 56:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InvalidateMontageState");M=g;N=f[0];x=b("bs_js_dict").fromArray(b("bs_js_dict").entries(M[14]));x[N]=[];return[M[0],M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8],M[9],M[10],M[11],M[12],M[13],x,M[15],M[16],M[17],M[18]];case 57:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("NewMontageMessage");J=g;U=f[0];K=b("bs_js_dict").fromArray(b("bs_js_dict").entries(J[14]));H=U.actor.id;w=b("bs_js_dict").get(K,H);if(w!==void 0){R=w;R.push(U);K[H]=R}else K[H]=[U];return[J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],K,J[15],J[16],J[17],J[18]];case 58:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InstantiateMontageThread");S=g;Q=f[0];Ab=b("bs_js_dict").fromArray(b("bs_js_dict").entries(S[14]));P=b("bs_js_dict").get(Ab,Q);P===void 0&&(Ab[Q]=[]);return[S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],Ab,S[15],S[16],S[17],S[18]];case 59:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeleteMontageMessage");O=g;var Db=f[0],Eb=b("bs_js_dict").fromArray(b("bs_js_dict").entries(O[14]));E=Object.keys(Eb);E.forEach(function(c){var a=b("bs_js_dict").get(Eb,c);if(a!==void 0){a=a.filter(function(a){return a.id!==Db.messageFBID});Eb[c]=a;return 0}else return 0});return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],O[8],O[9],O[10],O[11],O[12],O[13],Eb,O[15],O[16],O[17],O[18]];case 60:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("AddFetchedAllHistoryMarkers");var V=g;B=[f[0],f[1]];var Fb=B[1];B[0].forEach(function(b){var a=V[15].get(b);a==null?V[15].set(b,[1,[]]):V[15].set(b,[1,a[1]]);return Na(V[0],b,Fb)});return[V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7],V[8],V[9],V[10],V[11],V[12],V[13],V[14],V[15],V[16],V[17],V[18]];case 61:var W=g;L=f[0];L.forEach(function(c){__p&&__p();var a=c.folder;if(za.includes(a)){c=c.thread_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromThreadFBID(a)}).concat(c.other_user_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromUserID(a)}));W[16][a]=new Set(c);a=b("MercuryThreadInformer").getForFBID(W[0]);a.updatedUnreadState();return 0}else return 0});return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9],W[10],W[11],W[12],W[13],W[14],W[15],W[16],W[17],W[18]];case 62:var X=g,Gb=a;G=f[0];var d=[X[18]];G.forEach(function(a){X[17][a.folder]=a.unread_count;a.unread_count===0&&(X[16][a.folder]=new Set());a.folder===b("MessagingTag").INBOX&&(d[0]=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.seen_timestamp),d[0]),Gb[7][0]=a.unseen_count);a=b("MercuryThreadInformer").getForFBID(X[0]);a.updatedUnreadState();a.updatedUnseenState();return 0});return[X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12],X[13],X[14],X[15],X[16],X[17],d[0]];case 63:var Y=g,Hb=f[0];za.forEach(function(a){__p&&__p();a=b("bs_js_dict").get(Y[16],a);if(a!==void 0){var c=b("bs_caml_option").valFromOption(a);b("bs_js_dict").entries(Hb).forEach(function(a){var b=a[0];if(c.has(b)){c.add(a[1]);c["delete"](b);return 0}else return 0});return 0}else return 0});return[Y[0],Y[1],Y[2],Y[3],Y[4],Y[5],Y[6],Y[7],Y[8],Y[9],Y[10],Y[11],Y[12],Y[13],Y[14],Y[15],Y[16],Y[17],Y[18]];case 64:p=g;m=f[0];o=f[1];q=f[2];I=f[3];n=f[4];A=Ra(p,o);if(A!==void 0){F=b("bs_caml_option").valFromOption(A);ab(b("bs_caml_option").some(m),F);T=b("MessengerMessage.bs").makeFakeMessage(F.message_id,F.thread_id,F.author,F.action_type,F.timestamp,{removed_timestamp:I,message_unsendability_status:b("MessageUnsendabilityStatus").DENY_TOMBSTONE_MESSAGE,unsender:{id:q}});N=Ta(p,[o,T]);x=F.thread_id;if(x==null)return N;else{M=bb(N,o,x);Ma(M[0],x,o,n);Oa(M[0],x,o,n,F.attachments);w=b("bs_belt_Map").get(M[7],x);if(w!==void 0){R=b("bs_caml_option").valFromOption(w);H=cb(F.profile_ranges,M[0]);U=b("ImmutableObject").set(b("ImmutableObject").set(R,$a(M,x)),{unread_mentions_count:H?R.unread_mentions_count-1|0:R.unread_mentions_count});K=b("bs_belt_Map").set(M[7],x,U);s(M[0],x);return[M[0],M[1],M[2],M[3],M[4],M[5],M[6],K,M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15],M[16],M[17],M[18]]}else return M}}else{Pa(p[0],m,o,n);return p}case 65:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateConnectivityStatus");J=g;P=f[0];Q=f[1];Ab=b("ThreadConnectivityStatus.bs").toGraphQLValue(Q);S=b("bs_belt_Map").get(J[7],P);if(S!==void 0){E=b("bs_caml_option").valFromOption(S);O=E.thread_connectivity_data;B=O==null?b("ImmutableObject").set(E,{thread_connectivity_data:{connectivity_status:Ab,first_sender_id:null}}):b("ImmutableObject").set(E,{thread_connectivity_data:{connectivity_status:Ab,first_sender_id:O.first_sender_id}});return[J[0],J[1],J[2],J[3],J[4],J[5],J[6],b("bs_belt_Map").set(J[7],P,B),J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18]]}else return J;case 66:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeltaMarkFolderSeen");L=g;var Ib=f[0];return b("bs_belt_Array").reduceU(Ib.folders,L,function(c,a){a=b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,a);if(a!==void 0)return vb(c,Number(Ib.timestamp),a);else return c});case 67:G=g;A=[f[0],f[1],f[2],f[3]];var Jb=A[2];I=A[0];q=Ra(G,I);if(q!==void 0){T=b("bs_caml_option").valFromOption(q);N=A[1].concat(T.tags).filter(function(a){return Jb.indexOf(a)===-1});w=Object.assign(Object.assign({},T),{tags:N});F=T.thread_id;F==null||Ma(G[0],F,I,A[3]);return Ta(G,[I,w])}else return G;case 68:H=g;R=[f[0],f[1],f[2],f[3],f[4]];U=R[0];x=Ra(H,U);if(x!==void 0){K=b("bs_caml_option").valFromOption(x);M=K.attachments;if(M==null||M.length!==1)return H;else{m=M[0];o=R[2]?[Object.assign(Object.assign({},m),{blurred_image_uri:void 0})]:[Object.assign(Object.assign({},m),{blurred_image_uri:R[3]})];n=Object.assign(Object.assign({},K),{attachments:o});p=K.thread_id;p==null||Ma(H[0],p,U,R[4]);return Ta(H,[U,n])}}else return H}case 1:Q=k[0];if(typeof Q==="number")if(Q===0){S=g;var Kb=[];b("bs_belt_MapString").forEach(S[6],function(a,c){return b("bs_belt_Map").forEach(c,function(b,c){if(c<Date.now()-3e4){Kb.push([a,b]);return 0}else return 0})});if(Kb.length!==0){var c=[S[6]];Kb.forEach(function(a){c[0]=ka(c[0],a[0],a[1]);return 0});return[S[0],S[1],S[2],S[3],S[4],S[5],c[0],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15],S[16],S[17],S[18]]}else return S}else{E=g;Ab=a;if(ub(E,Ab,!1)>0){O=b("MercuryServerRequests").getForFBID(E[0]);O.markSeen();return vb(E,O.getLastActionTimestamp(),b("MessagingTag").INBOX)}else return E}else switch(Q.tag|0){case 0:var Z=g,Lb=a;P=Q[0];B=Q[1];J=Q[2];L=Q[3];var Mb=Z[7],Nb=[];q=i(P.reduce(function(d,c){var a=b("bs_belt_Map").get(Mb,c);if(a!==void 0)return b("bs_belt_Map").set(d,c,b("bs_caml_option").valFromOption(a));else{Nb.push(c);return d}},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Nb.length!==0){N=Lb[1];T=N[0].toString();Lb[1][0]=N[0]+1|0;Lb[0][0][T]=[P,J];F=b("MercuryServerRequests").getForFBID(Z[0]);A=Nb.reduce(function(d,c){__p&&__p();var e=b("MercuryIDs").tokenize(c),f=e.type;e=e.value;if(f==="user"){f=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(e));e=b("MercuryIDs").getParticipantIDFromUserID(Z[0]);var a=b("bs_caml_obj").caml_equal(f,e);a=b("MessengerThreadUtils.bs").createNewLocalThread(e,c,a?[e]:[e,f],null);e=b("bs_belt_Map").set(d,c,a);b("gkx")("1074761")||ob(e,Lb[0][0]);return e}else return d},Z[7]);F.fetchThreadData(Nb,L);b("bs_curry")._1(B,T);if(A===Z[7])return Z;else return[Z[0],Z[1],Z[2],Z[3],Z[4],Z[5],Z[6],A,Z[8],Z[9],Z[10],Z[11],Z[12],Z[13],Z[14],Z[15],Z[16],Z[17],Z[18]]}else{b("bs_curry")._1(J,q);return Z}case 1:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnsubscribeThread");I=a[0][0];b("bs_curry")._2(nb,I,Q[0]);a[0][0]=I;return g;case 2:var $=g;w=Q[0];G=b("bs_belt_Array").keepMap(w,function(a){a=Ra($,a);if(a!==void 0)return b("bs_caml_option").nullable_to_opt(b("bs_caml_option").valFromOption(a).offline_threading_id)});G.forEach(function(a){$[10]["delete"](a);return 0});return[$[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],$[8],$[9],$[10],$[11],$[12],$[13],$[14],$[15],$[16],$[17],$[18]];case 3:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontagePollStickerVoted");f=g;var Ob=Q[0];x=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f[14]));M=Ob.montageActorID;m=b("bs_js_dict").get(x,M);if(m!==void 0){o=m.map(function(c){__p&&__p();var a=b("bs_caml_obj").caml_equal(Ob.montageMessageID,c.id);if(a){a=c;var d=Ob,e=a.montage_overlays.map(function(a){__p&&__p();if(b("bs_caml_obj").caml_equal(a.poll.id,d.pollID)){var c=a.poll.poll_options.map(function(a,c){c=c===d.optionVotedIndex;if(c)return new(b("ImmutableObject"))({text:a.text,vote_count:a.vote_count+1|0});else return a});c=new(b("ImmutableObject"))({can_viewer_vote:a.poll.can_viewer_vote,id:a.poll.id,poll_options:c,viewer_vote_index:d.optionVotedIndex});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{poll:c})}else return a});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{montage_overlays:e})}else return c});x[M]=o}return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],x,f[15],f[16],f[17],f[18]];case 4:K=b("bs_belt_Map").set(g[7],Q[0],Q[1]);return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],K,g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15],g[16],g[17],g[18]];case 5:p=Q[1];if(p.tag){R=p[0];U={solid_color:R[3],header_color:b("bs_caml_array").caml_array_get(R[1],0),footer_color:b("bs_caml_array").caml_array_get(R[1],R[1].length-1|0),gradient_colors:R[1],theme_id:R[0],reactions:[]}}else{n=p[0];U={solid_color:n[1],header_color:n[1],footer_color:n[1],gradient_colors:[],theme_id:n[0],reactions:[]}}return wa(g,Q[0],U);case 6:b("MercuryServerRequests").getForFBID(g[0]).updateLastActionTimestamp(Q[0]);return g}case 2:H=k[0];switch(H.tag|0){case 0:b("bs_curry")._1(H[0],{blocked_ids:g[4]});break;case 1:b("bs_curry")._1(H[1],b("bs_belt_Map").get(g[7],H[0]));break;case 2:b("bs_curry")._1(H[0],g[13].concat([]));break;case 3:b("bs_curry")._2(H[0],g,a);break}return g}},d,c);e.length>0&&b("LogHistory").getInstance("messenger_state").debug("actions",b("bs_belt_Option").getWithDefault(b("bs_caml_option").undefined_to_opt(JSON.stringify(e)),""));return d}function wb(a){var c=[b("MercurySyncEventsProxy").getArbiterTypeForFBID(a,"TYP")];b("FBIDCheck").isUser_deprecated(a)||c.push(b("ChannelConstants").getArbiterType("page_typing"));return c}function xb(a){return[a,b("bs_belt_MapString").empty,b("bs_belt_MapString").empty,b("bs_belt_Set").make(b("ParticipantId.bs")),b("bs_belt_Set").make(b("ParticipantId.bs")),0,b("bs_belt_MapString").empty,b("bs_belt_Map").make(b("ThreadId.bs")),new Set(),new Map(),new Map(),new Map(),pa(0),[],{},new Map(),{},{},0]}ma=[{}];var yb=[0],D=new Map(),E=[{}],F=[0],G=new Set(),H=[{}],I=[0],J=[ma,yb,D,E,F,G,H,I],zb=[0],K={};function L(a,c,d){__p&&__p();d=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(0);c=b("bs_js_dict").get(K,a);if(c!==void 0)return 0;else{K[a]=[new Set(),xb(a),d];b("RemoteAction.bs").subscribe(function(d){__p&&__p();var c=b("bs_js_dict").get(K,a);if(c!==void 0){c=c;var e=c[1];d=C(J,d,e);K[a]=[c[0],d,c[2]];if(d!==e){c=b("bs_js_dict").get(K,a);if(c!==void 0){c[0].forEach(function(a){return b("bs_curry")._1(a[1],0)});return 0}else{b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return 0}}else return 0}else{b("recoverableViolation")("State deleted after creation","messenger_comet");return 0}},d);var e=b("bs_caml_option").some(a),f=a,g=function(a){return M(e,a)},h=function(a){b("bs_curry")._1(g,[b("bs_block").__(0,[b("bs_block").__(5,[a])])]);b("setTimeoutAcrossTransitions")(function(a){return b("bs_curry")._1(g,[b("bs_block").__(1,[0])])},3e4);return 0};b("Arbiter").subscribe(wb(f),function(a,b){a=b.obj;b=a.to;if(!(b==null)&&b.toString()!==f)return 0;else{h(a);return 0}});b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(a,c){__p&&__p();a=function(a,d){__p&&__p();var e={};b("bs_belt_MapString").toArray(a[2]).forEach(function(a){var b={};a[1].forEach(function(c,d,a){b[d]=c.watermark;return 0});e[a[0]]=b;return 0});d="read_receipts:"+f;c[d]=e;return 0};return b("bs_curry")._1(g,[b("bs_block").__(2,[b("bs_block").__(3,[a])])])});return 0}}function M(a,c){a=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();L(a,void 0,0);a=b("bs_js_dict").get(K,a);if(a!==void 0)return b("RemoteAction.bs").send(a[2],c);else{b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return 0}}function N(a,c,d,e){__p&&__p();var f=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();e=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(0);L(f,b("bs_caml_option").some(e),0);a=b("React").useState(function(){var a=b("bs_js_dict").get(K,f);if(a!==void 0)return a[1];else return b("unrecoverableViolation")("Rendering without state initialized","messenger_comet")});var g=a[1],h=a[0];c=b("bs_js_dict").get(K,f);var i=b("React").useCallback(function(a){a=b("bs_js_dict").get(K,f);var c=a!==void 0?a[1]:b("unrecoverableViolation")("Rendering without state initialized","messenger_comet");if(d!==void 0)if(b("bs_curry")._2(d,h,c))return b("bs_curry")._1(g,function(a){return c});else return 0;else return b("bs_curry")._1(g,function(a){return c})},[d,h,g,c,f]);b("React").useEffect(function(){__p&&__p();zb[0]=zb[0]+1|0;var a=zb[0],c=[a,i];a=b("bs_js_dict").get(K,f);a!==void 0?a[0].add(c):b("recoverableViolation")("Subscriptions deleted after createion, can't add subscription","messenger_comet");b("bs_curry")._1(i,0);return function(a){a=b("bs_js_dict").get(K,f);if(a!==void 0){a[0]["delete"](c);return 0}else{b("recoverableViolation")("Subscriptions deleted after createion, can't remove subscription","messenger_comet");return 0}}},[i,f]);return h}function O(a){var c=a.shouldUpdate,d=a.remoteAction,e=a.fbid;a=a.children;e=e!==void 0?b("bs_caml_option").valFromOption(e):b("CurrentUser").getID();return b("bs_curry")._1(a,N(b("bs_caml_option").some(e),d,c,0))}function P(a){return N(b("bs_caml_option").some(a),void 0,void 0,0)}function Q(a,c){return M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(0,[c])])])}function R(a,c){b("MercuryAssert").isThreadID(c);var d=[void 0],e=function(a){d[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);return b("bs_js_null_undefined").fromOption(d[0])}function Ab(a,c,d,e){__p&&__p();if(c.length!==0){b("MercuryAssert").allThreadID(c);var f=[null],g=function(a){f[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(0,[c,g,d,e])])]);return f[0]}else{b("bs_curry")._1(d,{});return null}}function S(a,c,d,e){return Ab(a,[c],function(a){return b("bs_curry")._1(d,a[c])},e)}function T(a,c,d,e){__p&&__p();var f=[void 0],g=function(a){f[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function U(a){var c=b("MercuryLocalIDs").generateThreadID(null);T(a,c,[],null);return c}function Bb(a,c,d,e){__p&&__p();var f=[void 0],g=function(a){f[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalGroupGeneralThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function Cb(a,c,d){var e=b("MercuryLocalIDs").generateThreadID(null);Bb(a,e,c,d);return e}function Db(a,c){var d=[void 0],e=function(a){d[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==void 0)return b("MercuryThreadInfo").isEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function Eb(a,c){var d=[void 0],e=function(a){d[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==void 0)return b("MercuryThreadInfo").isNewEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function V(c){var a=[[]],d=function(b){a[0]=b;return 0};M(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(2,[d])])]);return a[0]}function Fb(a,c,d){return M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(5,[c,d])])])}function W(a,c){return M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(1,[c])])])}function X(c){__p&&__p();var a=c.payload_source;if(a==null)return!1;else if(b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_FETCH_THREADLIST_INFO)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_THREAD_SYNC)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_MESSAGES)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS))return!0;else if(b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_INITIAL_DATA)){a=c.ordered_threadlists;return!(a==null)}else return!1}function Gb(a,c){c=b("bs_block").__(1,[b("bs_block").__(3,[c])]);return M(b("bs_caml_option").some(a),[c])}function Y(a,c){return M(a==null?void 0:b("bs_caml_option").some(a),c)}function Hb(c){__p&&__p();var d=[],e=!1;if(!(c==null)){var a=c.payload_source;!(a==null)&&b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)&&(e=!0);a=c.newlyAddedClientIDs;a==null||Object.keys(a).length>0&&d.push(b("bs_block").__(0,[b("bs_block").__(63,[a])]));a=c.delivery_receipts;a==null||d.push(b("bs_block").__(0,[b("bs_block").__(0,[a])]));a=c.message_ignored_ids;a==null||d.push(b("bs_block").__(0,[b("bs_block").__(1,[a])]));a=c.threads;if(!(a==null)){var f=c.payload_source;f==null||(b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)&&d.push(b("bs_block").__(0,[b("bs_block").__(8,[a])])),b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE)&&(a.length>0&&d.unshift(b("bs_block").__(0,[b("bs_block").__(34,[b("bs_caml_array").caml_array_get(a,0).thread_id])]))));d.push(b("bs_block").__(0,[b("bs_block").__(7,[a])]))}f=c.participants;if(!(f==null)){d.push(b("bs_block").__(0,[b("bs_block").__(3,[f])]));var g=[],h=[];f.forEach(function(a){if(a.is_messenger_blocked||a.is_facebook_blocked){g.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}else{h.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}});a=0;(g.length!==0||h.length!==0)&&(a=1);a===1&&d.push(b("bs_block").__(0,[b("bs_block").__(2,[g,h])]))}f=c.message_blocked_ids;f==null||f.length>0&&d.push(b("bs_block").__(0,[b("bs_block").__(2,[f,[]])]));a=c.message_unblocked_ids;a==null||a.length>0&&d.push(b("bs_block").__(0,[b("bs_block").__(2,[[],a])]));f=c.pending_folder_unseen_count;f==null||d.push(b("bs_block").__(0,[b("bs_block").__(4,[f])]));a=c.global_actions;a==null||a.forEach(function(a){if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_READ)){d.push(b("bs_block").__(0,[b("bs_block").__(33,[a.folder])]));return 0}else return 0});if(X(c)){f=c.ordered_threadlists;a=0;f==null||f.length===0?a=1:d.push(b("bs_block").__(0,[b("bs_block").__(9,[f])]));if(a===1){f=c.threads;a=c.payload_source;f==null||!(a==null)&&f.length>0&&a!==b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS&&d.push(b("bs_block").__(0,[b("bs_block").__(10,[f])]))}}a=c.pinned_thread_ids;a==null||a.length>0&&X(c)&&d.push(b("bs_block").__(0,[b("bs_block").__(11,[a])]));f=c.roger;f==null||d.push(b("bs_block").__(0,[b("bs_block").__(6,[f])]));a=c.montage_delete_message_delta;a==null||d.push(b("bs_block").__(0,[b("bs_block").__(59,[a])]));f=c.montage_new_message_delta;f==null||d.push(b("bs_block").__(0,[b("bs_block").__(57,[f])]));a=c.montage_poll_sticker_vote;a==null||a.forEach(function(a){d.push(b("bs_block").__(1,[b("bs_block").__(3,[a])]));return 0});f=c.current_montage_thread;if(!(f==null)){a=f.user;if(!(a==null)){f=a.messenger_montage_thread;f==null||(d.push(b("bs_block").__(0,[b("bs_block").__(58,[a.id])])),f.montage_messages.edges.forEach(function(a){d.push(b("bs_block").__(0,[b("bs_block").__(57,[a.node])]));return 0}))}}a=c.unread_thread_fbids;a==null||d.push(b("bs_block").__(0,[b("bs_block").__(61,[a])]));f=c.message_counts;f==null||d.push(b("bs_block").__(0,[b("bs_block").__(62,[f])]));a=c.actions;if(!(a==null)){var i=c.payload_source,j=i==null?void 0:b("bs_caml_option").some(i);a.forEach(function(a){__p&&__p();var e=a.action_type,f=0;(i==null||!i.startsWith("server"))&&(f=1);f===1&&d.push(b("bs_block").__(1,[b("bs_block").__(6,[a.timestamp])]));if(b("bs_caml_obj").caml_equal(j,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_SEARCH))||b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(a.client_state),b("bs_caml_option").some(b("MercuryMessageClientState").SEND_TO_SERVER))){d.push(b("bs_block").__(0,[b("bs_block").__(35,[a,0])]));return 0}else{f=a.thread_id;var g=a.upload_id,h=a.upload_data,k=a.message_ids;r(a);if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_MESSAGES))if(!(f==null)&&!(k==null)){d.push(b("bs_block").__(0,[b("bs_block").__(36,[f,k,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FOLDER)){k=a.new_folder;if(!(f==null)&&!(k==null)){d.push(b("bs_block").__(0,[b("bs_block").__(37,[f,k])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_ARCHIVED_STATUS))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(39,[f,a.archived])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_MUTE_SETTINGS)){k=a.reactions_mute_mode;var l=a.mentions_mute_mode,m=a.mute_until;l=k==null?l==null?m==null?void 0:b("bs_block").__(2,[m]):m==null?b("bs_block").__(1,[l===1]):void 0:!(l==null)||!(m==null)?void 0:b("bs_block").__(0,[k===1]);if(!(f==null)&&l!==void 0){d.push(b("bs_block").__(0,[b("bs_block").__(38,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_READ_STATUS))if(f==null)return 0;else{m=c.from_client;d.push(b("bs_block").__(0,[b("bs_block").__(41,[f,a.mark_as_read,a.timestamp,m==null?!1:m,a.source])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(40,[f,a.is_page_follow_up])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLOCK_STATUS_CHANGED))if(f==null)return 0;else{k=a.canViewerReply;l=k?null:b("MessengerThreadCannotReplyReason.bs").fromMessageThreadCannotReplyReason(a.reason);d.push(b("bs_block").__(0,[b("bs_block").__(13,[f,a.canViewerReply,l])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_THREAD))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(42,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REACTION_UPDATE)){m=a.messageId;k=a.userId;if(!(m==null)&&!(k==null)){d.push(b("bs_block").__(0,[b("bs_block").__(45,[m,b("bs_caml_option").nullable_to_opt(a.reaction),k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MONTAGE_DIRECT_EXPIRE)){l=a.messageId;if(l==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(46,[l,j])]));return 0}}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LIVE_LOCATION_UPDATE)){m=a.messageId;k=a.liveLocation;if(!(m==null)&&!(k==null)){d.push(b("bs_block").__(0,[b("bs_block").__(47,[m,k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REPLACE_MESSAGE)){d.push(b("bs_block").__(0,[b("bs_block").__(48,[a,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){d.push(b("bs_block").__(0,[b("bs_block").__(44,[g,h])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){d.push(b("bs_block").__(0,[b("bs_block").__(43,[g,h,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").SEND_MESSAGE)){d.push(b("bs_block").__(0,[b("bs_block").__(50,[a,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").USER_GENERATED_MESSAGE)){d.push(b("bs_block").__(0,[b("bs_block").__(51,[a,j,c.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LOG_MESSAGE))if(b("MessengerMessage.bs").isLocalMessage(a))return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(52,[a,j,c.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PINNED_STATUS))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(55,[f,a.is_pinned,a.thread_pin_timestamp])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PIN_MESSAGE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(53,[f,a.pin_message_action])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNPIN_MESSAGE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(54,[f,a.unpin_message_action])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_MESSAGE)){l=a.thread_id;m=a.messageId;k=a.removed_timestamp;g=a.author;if(!(l==null)&&!(m==null)&&!(k==null)&&!(g==null)){d.push(b("bs_block").__(0,[b("bs_block").__(64,[l,m,g,k,j])]));b("MessengerDesktopNotifications").removeNotification(m);return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(12,[f,a.page_unsubscribe_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLURRED_IMAGE_STATUS)){h=a.image_message_id;l=a.image_id;g=a.should_show;k=a.blurred_image_uri;if(!(h==null)&&!(l==null)&&!(g==null)&&!(k==null)){d.push(b("bs_block").__(0,[b("bs_block").__(68,[h,l,g,k,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADD_PARTICIPANTS))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(14,[f,a.participants])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FLAG))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(15,[f,a.mark_as_flag])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MOVE_PENDING_TO_INBOX))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(16,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CUSTOM_LIKE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(17,[f,a.custom_like])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PROMOTE_GROUP_ADMINS)){m=a.promoted_admins;if(!(f==null)&&!(m==null)){d.push(b("bs_block").__(0,[b("bs_block").__(18,[f,m])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_GROUP_ADMINS)){h=a.removed_admin_ids;if(!(f==null)&&!(h==null)){d.push(b("bs_block").__(0,[b("bs_block").__(19,[f,h])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").JOINABLE_MODE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(20,[f,a.joinable_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_MODE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(21,[f,a.approval_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_QUEUE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(22,[f,a.added_id,a.added_group_id,a.removed_id,a.removed_group_id])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").IS_PIN_PROTECTED))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(23,[f,a.is_pin_protected])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_RTC_CALL_DATA))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(24,[f,a.initiator_fbid,a.call_state,a.server_info_data])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_STATUS))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(25,[f,a.comm_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(26,[f,a.id,a.name,a.profile_pic_uri])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").EVENT_RSVP_CHANGED))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(27,[f,a.actor_fbid,a.rsvp_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS)){l=a.thread_connectivity_status;if(!(f==null)&&!(l==null)){d.push(b("bs_block").__(0,[b("bs_block").__(65,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(28,[f,a.groups_sync_action,a.groups_sync_status_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(29,[f,a.groups_sync_action,a.fb_group_id,a.emoji_codepoints])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DESCRIPTION_CHANGED))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(30,[f,a.group_thread_description_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_THREAD_THEME))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(31,[f,{solid_color:a.solid_color,header_color:a.header_color,footer_color:a.footer_color,gradient_colors:a.gradient_colors,theme_id:a.theme_id,reactions:a.reactions}])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_JOINABLE_LINK))if(f==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(32,[f,a.joinable_link])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MUTATE_TAGS)){g=a.tags_to_add;k=g==null?[]:g;m=a.tags_to_delete;h=m==null?[]:m;l=a.messageId;if(l==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(67,[l,k,h,j])]));return 0}}else return 0}});b("Utils.bs").isTruthy(c.from_client)&&a.forEach(function(c){var a=c.thread_id;if(a==null)return 0;else{d.push(b("bs_block").__(0,[b("bs_block").__(49,[a,c.message_id])]));return 0}})}f=c.end_of_history;f==null||d.push(b("bs_block").__(0,[b("bs_block").__(60,[f,c.payload_source])]))}e&&d.unshift(b("bs_block").__(0,[0]));return d}function Ib(c,d){var a=[[]],e=function(b,c){c=b[15].get(d);if(c==null)return 0;else{a[0]=y(!0,b,c[1]);return 0}};M(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function Jb(c,d){var a=[d],e=function(b,c){c=b[10].get(d);if(c==null)return 0;else{a[0]=c;return 0}};M(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function Kb(a,c){var d=[void 0],e=function(a,b){d[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d[0];if(a!==void 0)return y(!1,a,c);else return[]}function Z(a,c){var d=[void 0],e=function(a,b){d[0]=a;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d[0];if(a!==void 0)return b("bs_caml_option").nullable_to_opt(a[9].get(c))}function Lb(a,c,d){__p&&__p();var e=[!1],f=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];b=b[1].length;if(a){e[0]=!0;return 0}else{e[0]=b>=d;return 0}}};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[f])])]);return e[0]}function Mb(a,c){__p&&__p();var d=[!1],e=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];if(a){d[0]=!0;return 0}else{d[0]=!1;return 0}}};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d[0]}function Nb(a,c){return M(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(2,[c])])])}function $(a,c,d,e){__p&&__p();var f=[],g=function(g,h){__p&&__p();h=g[15].get(c);if(h==null)return 0;else{h=h[1];for(var i=d,j=d+e|0;i<=j;++i){var a=b("bs_belt_Option").flatMap(b("bs_belt_Array").get(h,i),function(a){return Ra(g,a)});a!==void 0&&f.push(b("bs_caml_option").valFromOption(a))}return 0}};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[g])])]);return f}var Ob=[void 0];function Pb(a,c,d,e,f,g,h){__p&&__p();var i=function(k,j){__p&&__p();Ob[0]=[c,d,e];var i=k[15].get(c);i=i==null?[[],void 0]:[i[1],i[0]];var l=i[0];if(b("bs_js_dict").get(j[6][0],c)!==!0){var m=j[2];m=l.length-b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(m.get(c)),0)|0;m>0&&b("ChatReliabilityInstrumentation").logERROR("fetch made with message in flight");var aa=m-d|0;aa=e-aa|0;if(aa>0&&b("bs_caml_obj").caml_notequal(i[1],1)){i=b("MercuryServerRequests").getForFBID(a);var ba=b("bs_js_null_undefined").fromOption(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_belt_Array").get(l,m-1|0),function(a){return Ra(k,a)}),function(a){return a.timestamp})),ca=j[4][0];j[4][0]=ca+1|0;j[3][0][String(ca)]=[[c,d,e],f];if(b("bs_caml_obj").caml_equal([c,d,e],Ob[0])){i.fetchThreadMessages(c,m,aa,ba,g,h);return 0}else return 0}else return b("bs_curry")._1(f,b("bs_belt_Array").keepMap(l,function(a){return Ra(k,a)}).slice(d,e))}else{Ob[0]=void 0;j[6][0][c]=!1;return 0}};return M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[i])])])}function Qb(a,b,c,d,e,f,g){if(Mb(a,b))return 0;else return Pb(a,b,c,d,e,f,g)}function Rb(a){var c=[0],d=function(d,a){c[0]=b("bs_caml_primitive").caml_int_min(B(d,a),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function Sb(a){var c=[0],d=function(b,a){c[0]=B(b,a);return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function Tb(a){var c=[0],d=function(d,a){c[0]=b("bs_caml_primitive").caml_int_min(ub(d,a,!0),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function Ub(a){return M(b("bs_caml_option").some(a),[b("bs_block").__(1,[1])])}function Vb(a,c){var d=[null],e=function(a,e){e=b("bs_js_dict").get(a[16],c);d[0]=e!==void 0?b("bs_belt_Array").keepMap(b("JSSet.bs").values(b("bs_caml_option").valFromOption(e)),function(c){return b("bs_caml_option").nullable_to_opt(j(a,c))}).filter(function(a){return!b("MercuryThreadInfo").isMuted(a)}).length:null;return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d[0]}function Wb(a){var c=[[]],d=function(a,d){c[0]=b("bs_belt_Map").keysToArray(a[7]);return 0};M(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}ma={make:O};yb=O;f.fbid=c;f.deliveryReceipts=d;f.readReceiptsPerThread=e;f.ignoredIds=k;f.blockedIds=l;f.pendingFolderUnseenCount=m;f.typing=aa;f.pendingReadStatusThreads=ba;f.messages=ca;f.localIDsMap=da;f.messagesWithUploadsInFlight=n;f.threadlistOrderMap=o;f.pinnedThreads=p;f.montage=q;f.orderedMessageLists=ea;f.unreadCounts=fa;f.initialUnreadCounts=ga;f.unseenTimestamp=ha;f.threads=a;f.thread=j;f.send=M;f.compute=Q;f.getThreadMetaNow=R;f.getMultiThreadMeta=Ab;f.getThreadMeta=S;f.createNewLocalThread=T;f.createNewLocalThreadGenerateID=U;f.createNewLocalGroupGeneralThreadGenerateID=Cb;f.isEmptyLocalThread=Db;f.isNewEmptyLocalThread=Eb;f.getPinnedThreadlist=V;f.unsubscribeThread=W;f.sendJS=Y;f.invalidateSearchedMessages=Nb;f.hasLoadedNMessages=Lb;f.hasLoadedAllMessages=Mb;f.getCurrentlyLoadedMessages=Ib;f.getServerMessageID=Jb;f.getMessagesFromIDs=Kb;f.getMessageFromID=Z;f.getThreadMessagesRange=Pb;f.getThreadMessagesRangeNow=$;f.fetchMoreMessages=Qb;f.processPollStickerVoted=Gb;f.getUnseenUnreadCount=Rb;f.getUnseenUnreadCountRaw=Sb;f.getUnseenCount=Tb;f.getThreadIDs_debug=Wb;f.getUnreadThreadCount=Vb;f.markAsSeen=Ub;f.localThreadThemeUpdate=Fb;f.processJSActions=Hb;f.Provider=ma;f.jsComponent=yb;f.useHook=P}),null);
__d("MessengerPersistantViewerKeyedSubscriptionComponent.bs",["bs_curry","React","bs_js_dict","bs_caml_option","CurrentUser","RemoteAction.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){__p&&__p();var c=[0],d={},e=function(a,c){a=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();var e=b("bs_js_dict").get(d,a);if(e!==void 0)return b("RemoteAction.bs").send(e[0],c);else{e=f(a,void 0,0);return b("RemoteAction.bs").send(e[0],c)}},f=function(f,g,h){__p&&__p();h=g!==void 0?b("bs_caml_option").valFromOption(g):b("RemoteAction.bs").create(0);var i=new Set(),j=[b("bs_curry")._1(a.initialState,f)];b("RemoteAction.bs").subscribe(function(c){var d=j[0];j[0]=b("bs_curry")._2(a.reducer,c,d);if(j[0]!==d){i.forEach(function(a){return b("bs_curry")._1(a[1],0)});return 0}else return 0},h);g=function(a,d){__p&&__p();var e=b("React").useState(function(){return j[0]}),f=e[1],g=e[0],k=b("React").useCallback(function(c){if(a!==void 0)if(b("bs_curry")._2(a,g,j[0]))return b("bs_curry")._1(f,function(a){return j[0]});else return 0;else return b("bs_curry")._1(f,function(a){return j[0]})},[a,g,j[0]]);b("React").useEffect(function(){c[0]=c[0]+1|0;var a=c[0],d=[a,k];i.add(d);b("bs_curry")._1(k,0);return function(a){i["delete"](d);return 0}},[k]);return b("bs_curry")._1(d,g)};h=[h,g];d[f]=h;var k=b("bs_caml_option").some(f);b("bs_curry")._2(a.onFirstMount,f,function(a){return e(k,a)});return h},g=function(a){var c=a.shouldUpdate,e=a.remoteAction,g=a.fbid;a=a.children;g=g!==void 0?b("bs_caml_option").valFromOption(g):b("CurrentUser").getID();var h=b("bs_js_dict").get(d,g);if(h!==void 0)return b("bs_curry")._2(h[1],c,a);else return b("bs_curry")._2(f(g,e,0)[1],c,a)};g.displayName="MessengerPersistantViewerKeyedSubscriptionComponent("+(a.displayName+")");return{make:g,send:e}}f.Make=a}),null);
__d("MessengerPresenceProvider.bs",["FBID.bs","bs_curry","React","Arbiter","bs_belt_Set","bs_caml_obj","bs_belt_Array","MercuryIDs","bs_belt_Option","bs_caml_option","OnlineUserIds.bs","ParticipantId.bs","PresenceStatus","PresencePrivacy","AvailableListConstants","MessengerPersistantViewerKeyedSubscriptionComponent.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=["privacy-changed","privacy-availability-changed","privacy-user-presence-response"];function a(a){return b("OnlineUserIds.bs").make(0)}function c(a,c){if(a){a=a[0];var d=b("bs_caml_obj").caml_equal(b("PresenceStatus").get(a),b("AvailableListConstants").ACTIVE);if(d)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(a));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(a))}else return b("bs_belt_Set").fromArray(b("bs_belt_Array").map(b("PresenceStatus").getOnlineIDs(),function(a){return b("MercuryIDs").getParticipantIDFromUserID(a)}),b("ParticipantId.bs"))}function d(a,c){__p&&__p();b("PresencePrivacy").subscribe(g,function(a){return b("bs_curry")._1(c,0)});b("bs_curry")._1(c,0);b("Arbiter").subscribe(b("AvailableListConstants").ON_AVAILABILITY_CHANGED,function(a,d){if(d==null)return 0;else{a=b("FBID.bs").ofStringExn(d);return b("bs_curry")._1(c,[a])}});return 0}a=b("MessengerPersistantViewerKeyedSubscriptionComponent.bs").Make({initialState:a,reducer:c,onFirstMount:d,displayName:"MessengerPresenceProvider"});var h=a.make;function i(a,c,d,e,f){f={children:e};a!==void 0&&(f.shouldUpdate=b("bs_caml_option").valFromOption(a));c!==void 0&&(f.remoteAction=b("bs_caml_option").valFromOption(c));d!==void 0&&(f.fbid=b("bs_caml_option").valFromOption(d));return f}function j(a){__p&&__p();var c=a.subscribeToIDs,d=a.remoteAction,e=a.fbid;a=a.children;d=i(function(a,d){if(c!==void 0){var e;d=(e=b("bs_belt_Set")).union(e.diff(a,d),e.diff(d,a));return!e.isEmpty(e.intersect(d,b("bs_caml_option").valFromOption(c)))}else return!1},d,e,a,0);return b("React").createElement(h,d)}function e(a){var c=b("ParticipantId.bs"),d={children:a.children},e=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(a.subscribeToIDs),function(a){return b("bs_belt_Set").fromArray(a,c)});e!==void 0&&(d.subscribeToIDs=b("bs_caml_option").valFromOption(e));e=b("bs_caml_option").nullable_to_opt(a.fbid);e!==void 0&&(d.fbid=b("bs_caml_option").valFromOption(e));return j(d)}c=a.send;d=j;f.privacyEvents=g;f.send=c;f.makePropsOriginal=i;f.make=d;f.jsComponent=e}),null);
__d("MessengerReadReceipt.bs",["bs_array","Utils.bs","immutable","bs_caml_option","bs_belt_MapString","MercuryActionStatus"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a,c,d,e){__p&&__p();c=c>=a.timestamp;var f=a.status;e=!e||d!==a.author;if(c)if(f==null)if(e)return!0;else return!1;else if(e)return f===b("MercuryActionStatus").SUCCESS;else return!1;else return!1}function a(a,c,d){__p&&__p();if(c==null)return[];else{a=b("bs_belt_MapString").get(a,c.thread_id);if(a!==void 0)return b("bs_caml_option").valFromOption(a).reduce(function(a,e,f,h){if(g(c,e.watermark,f,b("Utils.bs").isTruthy(d)))return b("bs_array").append(a,[f]);else return a},[]);else return[]}}function c(a,c){a=b("bs_belt_MapString").get(a,c.thread_id);if(a!==void 0)return b("bs_caml_option").valFromOption(a).reduce(function(a,b,d,e){if(a)return g(c,b.watermark,d,!1);else return!1},!0);else return!1}function d(a){return!b("bs_belt_MapString").isEmpty(a)}function e(a,c){if(b("bs_belt_MapString").isEmpty(a))return b("immutable").OrderedMap();else{a=b("bs_belt_MapString").get(a,c);if(a!==void 0)return b("bs_caml_option").valFromOption(a);else return b("immutable").OrderedMap()}}function h(a,c,d){a=b("bs_belt_MapString").get(a,c);if(a!==void 0){c=b("bs_caml_option").valFromOption(a).get(d);if(c==null)return null;else return c}else return null}var i=b("bs_belt_MapString").empty;f.emptyReadReceipts=i;f.wasSeen=g;f.getSeenBy=a;f.wasSeenByAll=c;f.hasReadReceipts=d;f.getSeenTimestamps=e;f.getSeenTimestamp=h}),null);