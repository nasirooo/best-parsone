if (self.CavalryLogger) { CavalryLogger.start_js(["AEGLC"]); }

__d("DeveloperCommunicationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1={}}var c=a.prototype;c.log=function(){b("GeneratedLoggerUtils").log("logger:DeveloperCommunicationLoggerConfig",this.$1,b("Banzai").BASIC)};c.logVital=function(){b("GeneratedLoggerUtils").log("logger:DeveloperCommunicationLoggerConfig",this.$1,b("Banzai").VITAL)};c.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:DeveloperCommunicationLoggerConfig",this.$1,{signal:!0})};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setAggregatedAlertDataID=function(a){this.$1.aggregated_alert_data_id=a;return this};c.setAppID=function(a){this.$1.app_id=a;return this};c.setDevAlertGroupCustom=function(a){this.$1.dev_alert_group_custom=a;return this};c.setDevAlertID=function(a){this.$1.dev_alert_id=a;return this};c.setDevAlertSource=function(a){this.$1.dev_alert_source=a;return this};c.setDevNotifMedium=function(a){this.$1.dev_notif_medium=a;return this};c.setDevNotifType=function(a){this.$1.dev_notif_type=a;return this};c.setDocPageDescription=function(a){this.$1.doc_page_description=a;return this};c.setEmailCompletionStatus=function(a){this.$1.email_completion_status=a;return this};c.setEvent=function(a){this.$1.event=a;return this};c.setJewelCompletionStatus=function(a){this.$1.jewel_completion_status=a;return this};c.setMarkdownPageIds=function(a){this.$1.markdown_page_ids=b("GeneratedLoggerUtils").serializeVector(a);return this};c.setNotifDeliveryID=function(a){this.$1.notif_delivery_id=a;return this};c.setNotifEnvironment=function(a){this.$1.notif_environment=a;return this};c.setNotifID=function(a){this.$1.notif_id=a;return this};c.setNotifMedium=function(a){this.$1.notif_medium=a;return this};c.setNotifMediumSendResult=function(a){this.$1.notif_medium_send_result=a;return this};c.setObjective=function(a){this.$1.objective=a;return this};c.setPocTeam=function(a){this.$1.poc_team=a;return this};c.setRecipientID=function(a){this.$1.recipient_id=a;return this};c.setRecipientType=function(a){this.$1.recipient_type=a;return this};c.setRef=function(a){this.$1.ref=a;return this};c.setTime=function(a){this.$1.time=a;return this};c.setType=function(a){this.$1.type=a;return this};c.setWeight=function(a){this.$1.weight=a;return this};c.updateExtraData=function(a){a=b("nullthrows")(b("GeneratedLoggerUtils").serializeMap(a));b("GeneratedLoggerUtils").checkExtraDataFieldNames(a,g);this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.addToExtraData=function(a,b){var c={};c[a]=b;return this.updateExtraData(c)};return a}();var g={aggregated_alert_data_id:!0,app_id:!0,dev_alert_group_custom:!0,dev_alert_id:!0,dev_alert_source:!0,dev_notif_medium:!0,dev_notif_type:!0,doc_page_description:!0,email_completion_status:!0,event:!0,jewel_completion_status:!0,markdown_page_ids:!0,notif_delivery_id:!0,notif_environment:!0,notif_id:!0,notif_medium:!0,notif_medium_send_result:!0,objective:!0,poc_team:!0,recipient_id:!0,recipient_type:!0,ref:!0,time:!0,type:!0,weight:!0};e.exports=a}),null);
__d("DeveloperCommunicationLogger",["CurrentUser","DeveloperCommunicationTypedLogger"],(function(a,b,c,d,e,f){"use strict";function a(a){a=a?"jewel_list_open":"jewel_list_close";new(b("DeveloperCommunicationTypedLogger"))().setEvent(a).setType("dev_alert").setRecipientID(b("CurrentUser").getID()).log()}e.exports={logJewelToggle:a}}),null);
__d("NotificationJewelListController",["DeveloperCommunicationLogger","FBAMetaMegaMenuLogger","NotificationComponentsBootloader","NotificationListConfig","React","ReactDOM","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g=b("NotificationListConfig").numNotificationsPerPage,h=null,i=null,j=null;a=function(){"use strict";__p&&__p();function a(a,b){this.$1=!1,this.$2=!1,this.$3=!1,this.$4=a,this.$5=b}var c=a.prototype;c.open=function(){this.$1=!0,this.$6()};c.pause=function(){this.$2=!0,this.$5.pageType==="ANALYTICS"?b("FBAMetaMegaMenuLogger").logMegaMenuNotificationBellToggle(this.$2):this.$5.pageType==="APP_DASHBOARD"&&b("DeveloperCommunicationLogger").logJewelToggle(this.$2),this.$6()};c.unpause=function(){this.$2=!1,this.$5.pageType==="ANALYTICS"?b("FBAMetaMegaMenuLogger").logMegaMenuNotificationBellToggle(this.$2):this.$5.pageType==="APP_DASHBOARD"&&b("DeveloperCommunicationLogger").logJewelToggle(this.$2),this.$6()};c.setFlyoutOpenState=function(a){this.$3=a,this.$6()};c.$6=function(){var a=this;!h||!i?b("promiseDone")(b("NotificationComponentsBootloader").load(this.$5.isBizsite),function(b){var c=b[0],d=b[1];b=b[2];h=c;i=d;j=b;a.$7()}):this.$7()};c.$7=function(){var a=this;if(!h||!i||!j)return;b("ReactDOM").render(b("React").jsx(j,{children:b("React").jsx(h,{hasEverBeenOpened:this.$1,paused:this.$2,isBucketingDisabled:this.$5.isBucketingDisabled,isNotifsIntl:this.$5.isNotifsIntl,isFlyoutOpened:this.$3,classification:this.$5.classification,tracking:this.$5.tracking,shortenTimestamp:this.$5.shortenTimestamp,businessID:this.$5.businessID,defaultTab:this.$5.defaultTab,maxHeight:this.$5.maxHeight,useChevron:this.$5.useChevron,chevronType:this.$5.chevronType,numPerPage:g,listRenderer:i,upsell:this.$5.upsell||null,endpoint:this.$5.endpoint,sourceView:this.$5.sourceView,settingsUri:this.$5.settingsUri,onClick:function(c,d){a.$5.pageType==="ANALYTICS"&&b("FBAMetaMegaMenuLogger").logMegaMenuNotificationClick(c,d)}})}),this.$4)};return a}();e.exports=a}),null);
__d("JewelBadgeCountRecorder",["invariant","Arbiter","performanceNow"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=Object.create(null);a={onCountUpdated:function(a,c){i[c.jewel]==null&&(i[c.jewel]=[]);a=i[c.jewel];a.push({timestamp:(h||(h=b("performanceNow")))(),count:c.count});a.length>1e3&&a.shift()},getCountAtTimestamp:function(a,b){var c=i[a];c!=null||g(0,2483,a,JSON.stringify(i));c.length>0||g(0,2484,a);a=c.find(function(a,d){var e=c[d+1];return d===0&&b<a.timestamp||b>a.timestamp&&(e==null||b<e.timestamp)});a||g(0,2485);return a.count}};b("Arbiter").subscribe("jewel/count-updated",a.onCountUpdated);e.exports=a}),null);
__d("FriendingSurfaceVisitationTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1={}}var c=a.prototype;c.log=function(){b("GeneratedLoggerUtils").log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,b("Banzai").BASIC)};c.logVital=function(){b("GeneratedLoggerUtils").log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,b("Banzai").VITAL)};c.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:FriendingSurfaceVisitationLoggerConfig",this.$1,{signal:!0})};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setAppVersion=function(a){this.$1.app_version=a;return this};c.setBadgeCount=function(a){this.$1.badge_count=a;return this};c.setClientTimestamp=function(a){this.$1.client_timestamp=a;return this};c.setIsTab=function(a){this.$1.is_tab=a;return this};c.setRawRefTab=function(a){this.$1.raw_ref_tab=a;return this};c.setRawTab=function(a){this.$1.raw_tab=a;return this};c.setRefPage=function(a){this.$1.ref_page=a;return this};c.setSurface=function(a){this.$1.surface=a;return this};c.setTargetProfileID=function(a){this.$1.target_profile_id=a;return this};c.setTime=function(a){this.$1.time=a;return this};c.setVC=function(a){this.$1.vc=a;return this};c.setWeight=function(a){this.$1.weight=a;return this};return a}();c={app_version:!0,badge_count:!0,client_timestamp:!0,is_tab:!0,raw_ref_tab:!0,raw_tab:!0,ref_page:!0,surface:!0,target_profile_id:!0,time:!0,vc:!0,weight:!0};e.exports=a}),null);
__d("BanzaiLooper",["Banzai"],(function(a,b,c,d,e,f){var g={retry:!0};function h(a,c){b("Banzai").post("banzai_looper:"+a,c,g)}a={labelBinaryClassificationExample:function(a){h("binary_classification_example",babelHelpers["extends"]({operation:"label"},a))}};e.exports=a}),null);
__d("normalizedEventTimestamp",["performance"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;function a(a){if(a!=null)if((g||(g=b("performance")))&&(g||(g=b("performance"))).timing&&(g||(g=b("performance"))).timing.navigationStart&&a>(g||(g=b("performance"))).timing.navigationStart)return a-=(g||(g=b("performance"))).timing.navigationStart;else return a;else if((g||(g=b("performance"))).now)return(g||(g=b("performance"))).now();return null}e.exports=a}),null);
__d("reportData",["Banzai","SessionName","ifRequired"],(function(a,b,c,d,e,f){__p&&__p();var g={retry:!0};function a(a,c){c===void 0&&(c={});c={ft:c.ft||{},gt:c.gt||{}};var d="-",e="r",f=b("ifRequired")("URI",function(a){return a.getRequestURI(!0,!0).getUnqualifiedURI().toString()},function(){return location.pathname+location.search+location.hash});a=[b("SessionName").getName(),Date.now(),"act",Date.now(),0,d,a,d,d,e,f,c,0,0,0,0];b("Banzai").post("eagle_eye_event",a,g)}e.exports=a}),null);
__d("JewelBase",["csx","invariant","Promise","Arbiter","ArbiterMixin","Bootloader","CrossWindowEventEmitter","CSS","DOM","Event","FriendingSurfaceVisitationTypedLogger","FunnelLogger","HTML","JewelBadgeCountRecorder","JewelCountSideLoader","JewelLogger","Keys","MercuryConfig","NotificationJewelFunnelLoggingConstants","P2BWWWNotificationConfig","Run","TabIsolation","TimeSlice","Toggler","TooltipData","firstClickTimestamp","killswitch","mixin","normalizedEventTimestamp","performance","performanceNow","promiseDone","reportData"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i,j,k=b("JewelLogger").logJewelCancel,l=b("JewelLogger").logJewelClick,m=b("JewelLogger").logJewelInitialize,n=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT,o=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,p=new(b("CrossWindowEventEmitter"))("JewelBase"),q={};function r(){if((i||(i=b("performance")))==null?void 0:(i||(i=b("performance"))).getEntriesByName){var a=(i||(i=b("performance"))).getEntriesByName("first-paint","paint");if(a&&a[0])return b("normalizedEventTimestamp")(a[0].startTime)}return null}a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d){__p&&__p();var e;e=a.call(this)||this;e.name=d.name;e.label=d.label;e.clickCount=0;e.root=c;e.badge=d.badge;e.countNew=0;e.initialCount=d.count||0;e.userCount=0;e.pageCount=0;e.escHandler=null;e.bootload_module=d.bootload_module;e.bootload_args=d.bootload_args;e.bootload_eager_modules=d.bootload_eager_modules;e.bootload_conf=d.bootload_conf;e.bootloading=null;e.togglerInstance=b("Toggler").getInstance(c).setSticky(!1);e.businessID=d.businessID;e.loggerRef=d.loggerRef;m({jewelName:e.name,badgeInitialCount:e.initialCount,timestamp:r()});b("JewelBadgeCountRecorder").onCountUpdated("jewel/initial-count",{jewel:e.name,count:e.initialCount});e.bootload_conf&&e.bootload_conf.eagerLoadingOnInteraction?e.$JewelBase3():b("Run").onAfterLoad(function(){return e.$JewelBase4()});e.bootload_conf&&e.bootload_conf.eagerLoadingOnInteraction&&e.$JewelBase5();d.keepOpenForSnowlift&&e.togglerInstance.setPrePageTransitionCallback(e.$JewelBase6.bind(babelHelpers.assertThisInitialized(e)));q[e.name]=babelHelpers.assertThisInitialized(e);e.$JewelBase7();c=e.getFlyout();c||h(0,5194);var f=new(b("TabIsolation"))(c);b("killswitch")("JEWEL_TOGGLER_INSTANCE_FIXES")?b("Toggler").createInstance(c).setSticky(!1):b("Toggler").createInstance(e.root).setSticky(!1);e.$JewelBase8();b("Toggler").listen("show",e.root,function(a){__p&&__p();var c=this;b("FunnelLogger").appendAction(o,n.OPEN_JEWEL);this.$JewelBase9();this.inform("user-open");this.hasNew()&&this.markSeen();this.reset();b("Arbiter").inform("layer_shown",{type:"Jewel",name:this.name});f.enable();this.setupEvents();this.$JewelBase10();this.bootload_conf&&this.bootload_conf.eagerLoadingOnInteraction?this.$JewelBase11():b("promiseDone")(this.$JewelBase4().then(function(){return c.inform("opened")}))}.bind(babelHelpers.assertThisInitialized(e)));b("Toggler").listen("hide",e.root,function(a,c){k(),b("FunnelLogger").appendAction(o,n.CLOSE_JEWEL),b("FunnelLogger").endFunnel(o),this.hasNew()&&this.markSeen(),this.reset(),this.inform("closed"),b("Arbiter").inform("layer_hidden",{type:"Jewel"}),f.disable(),this.removeEvents(),this.$JewelBase8()}.bind(babelHelpers.assertThisInitialized(e)));b("Arbiter").subscribe("jewel/count-updated",function(a,b){b.jewel==e.name&&e.update(b)});b("Arbiter").subscribe("jewel/hide",function(a,b){e.hide()});p.addListener("count-updated",function(a){a.jewel==e.name&&e.update(a)});return e}var d=c.prototype;d.getRoot=function(){return this.root};d.hide=function(){this.isOpen()&&b("Toggler").hide(this.root)};d.getFlyout=function(){this.$JewelBase1==null&&(this.$JewelBase1=b("DOM").find(this.root,".__tw"));return this.$JewelBase1};d.hasNew=function(){return b("CSS").hasClass(this.root,"hasNew")};d.isOpen=function(){return b("CSS").hasClass(this.root,"openToggler")};d.reset=function(){b("FunnelLogger").appendAction(o,n.CLEAR_BADGE_COUNT),b("CSS").removeClass(this.root,"hasNew")};d.setContent=function(a){var c=b("DOM").find(this.root,"ul.jewelItemList");b("DOM").setContent(c,b("HTML")(a))};d.update=function(a){__p&&__p();var c;a.animation&&this.badge.setAnimation&&this.badge.setAnimation(a.animation);this.countNew=a.count;this.userCount=(c=a.userCount)!=null?c:0;this.pageCount=(c=a.pageCount)!=null?c:0;typeof this.countNew==="number"&&this.countNew<0&&(this.countNew=0);this.badge.setLegacyContent(this.countNew);c=isNaN(this.countNew)||this.countNew>0;b("CSS").conditionClass(this.root,"hasNew",c);this.updatedOnce=!0;this.inform("updated",a,"state")};d.setupEvents=function(){var a=this;this.escHandler=b("Event").listen(document.documentElement,"keydown",function(c){c.keyCode===b("Keys").ESC&&a.hide()})};d.removeEvents=function(){this.escHandler&&(this.escHandler.remove(),this.escHandler=null)};d.markSeen=function(){var a=this,c=function(){b("Arbiter").inform("jewel/count-updated",{jewel:a.name,count:0},"state"),p.emitRemote("count-updated",{jewel:a.name,count:0}),a.inform("marked-seen")};b("TimeSlice").guard(c,"JewelOpen markSeen",{propagationType:b("TimeSlice").PropagationType.ORPHAN})()};d.getButton=function(){this.$JewelBase2==null&&(this.$JewelBase2=b("DOM").find(this.root,"a.jewelButton"));return this.$JewelBase2};d.$JewelBase8=function(){var a=this.getButton();b("TooltipData").set(a,this.label);a.setAttribute("data-tooltip-delay","500")};d.$JewelBase10=function(){b("TooltipData").remove(this.getButton())};d.$JewelBase6=function(a,b){!this.$JewelBase12(b.from)&&!this.$JewelBase12(b.to)&&(this.togglerInstance&&this.togglerInstance.hide())};d.$JewelBase12=function(a){return a&&Object.prototype.hasOwnProperty.call(a.getQueryData(),"theater")};d.$JewelBase9=function(){__p&&__p();var a=this;this.clickCount++;var c=this.getButton(),d=(j||(j=b("performanceNow")))();this.clickCount===1&&(d=b("firstClickTimestamp").get(c));d&&(d=b("normalizedEventTimestamp")(d),d&&l({jewelName:this.name,timestamp:d,badgeCurrentCount:b("JewelBadgeCountRecorder").getCountAtTimestamp(this.name,d),badgeInitialCount:this.initialCount,clickCount:this.clickCount}));b("reportData")("jewel_click",{gt:babelHelpers["extends"]({count:this.countNew,initial:this.initialCount,jewel:this.name},this.businessID?{biz_id:this.businessID}:{},this.loggerRef?{ref:this.loggerRef}:{})});this.name==="requests"&&new(b("FriendingSurfaceVisitationTypedLogger"))().setSurface("jewel").setBadgeCount(this.countNew).log();this.name==="mercurymessages"&&b("MercuryConfig").PageThreadlistTabConfig&&b("Bootloader").loadModules(["CurrentUser","WebFunnelLogger","MessengerJewelNotificationWebFunnelAction"],function(c,d,e){new d("MessengerJewelNotificationWebFunnelDefinition").setAction(e.MESSENGER_JEWEL_CLICKED).setSessionKey(c.getAccountID()).addFunnelPayload("pageID",b("MercuryConfig").PageThreadlistTabConfig.pageID).addActionPayload("pageUnseenCount",a.pageCount).addActionPayload("userUnseenCount",a.userCount).addActionPayload("notificationsEnabled",b("MercuryConfig").PageThreadlistTabConfig.unseenJewelEnabled).markStart().log()},"JewelBase");b("P2BWWWNotificationConfig").pageID!==null&&(this.name==="mercurymessages"&&b("Bootloader").loadModules(["PageInboxEntryPointsTypedLogger","PageInboxEntryPointEvent","PageInboxEntryPoint"],function(c,d,e){new c().setVC().setPageID(b("P2BWWWNotificationConfig").pageID).setEvent(d.CLICK).setLocation(e.JEWEL_DROPDOWN).setBadgeNum(a.countNew).log()},"JewelBase"))};d.$JewelBase4=function(){var a=this;if(!this.bootload_module)return b("Promise").resolve();this.bootloading||(this.bootloading=new(b("Promise"))(function(b,c){a.bootload_module.load().then(function(c){new c(a,a.bootload_args),b()})["catch"](c)}));return this.bootloading};d.$JewelBase3=function(){var a=this;this.bootload_eager_modules?this.bootload_eager_modules.loadModules(this):b("Run").onAfterLoad(function(){return a.$JewelBase4()})};d.$JewelBase5=function(){this.bootload_eager_modules&&this.bootload_eager_modules.mount(this)};d.$JewelBase11=function(){var a=this;this.bootload_eager_modules?this.bootload_eager_modules.load(this):b("promiseDone")(this.$JewelBase4().then(function(){return a.inform("opened")}))};d.$JewelBase7=function(){if(this.bootloading)return;var a=b("JewelCountSideLoader").getOverwritesForJewel(this);if(!a)return;this.updateCountAndArgs(a.args,a.count)};d.updateCountAndArgs=function(a,c){for(var d in a)a[d]&&(this.bootload_args[d]=a[d]);c&&b("Arbiter").inform("jewel/count-updated",{jewel:this.name,count:c},"state")};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);
__d("BrowserPushMessageRedirectUtil",["Bootloader"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){var c="(messages)(.*?)(?:(tid=))([^&]*)";a=a.match(c);if(!a)return!0;var d=a.pop();b("Bootloader").loadModules(["FantaTabActions"],function(a){a.openTab(d)},"BrowserPushMessageRedirectUtil");return!1};e.exports=a}),null);
__d("MPushPermissionUtil",["BanzaiLogger","gkx"],(function(a,b,c,d,e,f){function a(a){var c=b("gkx")("910664");c&&b("BanzaiLogger").log("ChromePushPermissionEventsLoggerConfig",{event:a})}e.exports={logEvent:a}}),null);
__d("BrowserPushCommands",[],(function(a,b,c,d,e,f){a="browser_push_ack";b="browser_push_redirect";c="browser_push_window_visible";d={ACK:a,REDIRECT:b,WINDOW_VISIBLE:c};e.exports=d}),null);
__d("BrowserPushMessageHandler",["BrowserPushCommands","BrowserPushMessageRedirectUtil","EventListener","URI","URISchemes","isFacebookURI"],(function(a,b,c,d,e,f){__p&&__p();var g,h;function i(a){__p&&__p();if(a.data.command&&a.data.command===b("BrowserPushCommands").REDIRECT){if(window.onbeforeunload()===void 0)a.ports[0].postMessage({command:b("BrowserPushCommands").ACK,success:!0});else{a.ports[0].postMessage({command:b("BrowserPushCommands").ACK,success:!1});return}a=a.data.uri;if(/^([^.:/?#]+):/.test(a)&&!(g||(g=b("URISchemes"))).isAllowed(/^([^.:/?#]+):/.exec(a)[1])||!b("isFacebookURI")(new(h||(h=b("URI")))(a)))throw new Error("goURI: URI scheme rejected, URI: "+a);b("BrowserPushMessageRedirectUtil")(a)&&(window.location.href=a)}}a={registerRedirectHandler:function(){b("EventListener").listen(window,"message",function(a){a.origin===""&&i(a)}),navigator.serviceWorker&&navigator.serviceWorker.addEventListener&&navigator.serviceWorker.addEventListener("message",function(a){(navigator.serviceWorker&&navigator.serviceWorker.controller&&a.target&&a.target.controller&&a.target.controller===navigator.serviceWorker.controller||new RegExp("^"+window.location.protocol+"//"+window.location.host+"$").test(a.origin))&&i(a)})}};e.exports=a}),null);
__d("BrowserPushVisibilityChanger",["BrowserPushCommands","ClientServiceWorkerMessage","Visibility"],(function(a,b,c,d,e,f){function g(){new(b("ClientServiceWorkerMessage"))(b("BrowserPushCommands").WINDOW_VISIBLE,null).sendViaController()}a={listenForVisibility:function(){b("Visibility").isHidden()||g(),b("Visibility").addListener(b("Visibility").VISIBLE,g)}};e.exports=a}),null);
__d("PushRegistrationUtils",[],(function(a,b,c,d,e,f){"use strict";var g={normalizeSubscriptionEndpoint:function(a){var b=a.endpoint;"subscriptionId"in a&&!new RegExp("/"+a.subscriptionId+"$").test(b)&&(b+="/"+a.subscriptionId);return b},setupPushRegistrationData:function(a,b){var c=g.normalizeSubscriptionEndpoint(a),d=null;a.toJSON?d=a.toJSON().keys:a.keys&&(d=a.keys);return{app_id:b,push_endpoint:c,subscription_keys:JSON.stringify(d)}}};e.exports=g}),null);
__d("XAsyncPushMuteController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/settings/push/mute/",{appid:{type:"Int",required:!0},push_endpoint:{type:"String",required:!0},mute_for:{type:"Enum",enumType:0}})}),null);
__d("XAsyncPushMuteStateController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/settings/push/mute/state/",{appid:{type:"Int",required:!0},push_endpoint:{type:"String",required:!0}})}),null);
__d("PushRegistration",["Promise","BrowserPushMessageHandler","BrowserPushPubKey","BrowserPushVisibilityChanger","MPushPermissionUtil","PushRegistrationUtils","ServiceWorkerRegistration","XAsyncPushMuteController","XAsyncPushMuteStateController","emptyFunction","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g=window.Notification,h=new Map();a=function(){"use strict";__p&&__p();a.get=function(b,c){if(h.has(c))return h.get(c);b=new a(b,c);h.set(c,b);return b};function a(b,c){this.$3=b,this.appID=c,!a.$1&&!a.$2&&(a.$1=!1,a.$2=!1)}var c=a.prototype;c.getPushSubscription=function(){var c=this;return new(b("Promise"))(function(d,e){a.pushPermissionIsDenied()&&(b("MPushPermissionUtil").logEvent("permission_denied_or_blocked"),e(new Error("No permission or not supported"))),b("ServiceWorkerRegistration").getWorkerRegistration(c.$3).then(function(a){if(!a){d(null);return}a.pushManager.getSubscription().then(function(a){d(a)})["catch"](e)})["catch"](e)})};c.$4=function(a,c,d,e){a=a.getURIBuilder().getURI();c=new c(a);c.setData(b("PushRegistrationUtils").setupPushRegistrationData(d,this.appID));c.setMethod("post");c.setHandler&&c.setHandler(function(a){a.payload&&a.payload.session_change&&e()});c.send()};c.getMutedUntilInServer=function(a){__p&&__p();var c=this;return new(b("Promise"))(function(d,e){__p&&__p();c.getPushSubscription().then(function(f){if(f){f=b("PushRegistrationUtils").normalizeSubscriptionEndpoint(f);f=b("XAsyncPushMuteStateController").getURIBuilder().setString("push_endpoint",f).setInt("appid",c.appID).getURI();f=new a(f);f.listen("done",function(a){d(a.payload.muteUntilTimestampSec)});f.send()}else e("cannot check mute status for unsubscribed endpoint")})["catch"](e)})};c.muteNotifications=function(a,c){__p&&__p();var d=this;return new(b("Promise"))(function(e,f){__p&&__p();d.getPushSubscription().then(function(g){__p&&__p();if(g){g=b("PushRegistrationUtils").normalizeSubscriptionEndpoint(g);g=b("XAsyncPushMuteController").getURIBuilder().setEnum("mute_for",a).setString("push_endpoint",g).setInt("appid",d.appID).getURI();g=new c(g);g.setMethod("POST");g.listen("done",function(b){a!==0&&b.payload.muteUntilTimestampSec===0?f("operation failed in server"):e(b.payload.muteUntilTimestampSec)});g.send()}else f("no subscription found")})["catch"](f)})};c.getSubscription=function(){var a=this;return new(b("Promise"))(function(c,d){a.getPushSubscription().then(function(a){a?c(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(a)):c(null)})["catch"](d)})};c.maybeRegisterPushAgain=function(a,c,d){var e=this;return new(b("Promise"))(function(f,g){e.getPushSubscription().then(function(g){g?(e.$4(a,c,g,d),f(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(g))):f(null)})["catch"](function(){f(null)})})};c.$5=function(c,d,e){__p&&__p();var f=this;return new(b("Promise"))(function(b,g){__p&&__p();if(a.$2&&!e){g(new Error("sending disable info already"));return}a.$2=!0;var h=c.getURIBuilder().getURI();h=new d(h.toString());h.setData({appid:f.appID,from_browser_settings:e});h.setMethod("post");h.listen?(h.listen("finally",b),h.listen("fail",function(){a.$2=!1,g()})):h.setErrorHandler&&h.setHandler?(h.setErrorHandler(function(){a.$2=!1,g()}),h.setHandler(b)):b();h.send()})};c.isPushRegistered=function(c,d,e,f,g,h,i){var j=this;g===void 0&&(g=!1);h===void 0&&(h=b("emptyFunction"));i===void 0&&(i=!1);b("BrowserPushMessageHandler").registerRedirectHandler();return new(b("Promise"))(function(k,l){j.getPushSubscription().then(function(l){k(!!l||c&&!a.pushPermissionIsPending()),l?g?j.$4(d,f,l,h):b("BrowserPushVisibilityChanger").listenForVisibility():!l&&c&&(a.pushPermissionIsOn()?j.registerPush(d,f,h,i)["catch"](function(){}):j.$5(e,f,!1))})["catch"](function(){c&&j.$5(e,f,!1),i&&b("ServiceWorkerRegistration").unregisterControllingWorker(),l()})})};c.$6=function(){return new(b("Promise"))(function(a,b){g.requestPermission(a)})};c.registerPushAndWaitForEndpoint=function(a,c,d,e){var f=this;e===void 0&&(e=!1);return new(b("Promise"))(function(b,g){f.$7(a,c,d,!0,null,e).then(function(a){if(typeof a!=="string"){g(new Error("registerPushImpl did not return an endpoint"));return}b(a)})["catch"](g)})};c.registerPushOnKaiOS=function(a,c,d){var e=this;return new(b("Promise"))(function(f,g){d.waitForKaiOS().done(function(){d.registerPush(function(d){d=JSON.parse(d.get("push_endpoint"));e.$4(a,c,d,b("emptyFunction"));f(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(d))})})})};c.registerPush=function(a,c,d,e,f){d===void 0&&(d=b("emptyFunction"));e===void 0&&(e=!1);f===void 0&&(f=b("emptyFunction"));return this.registerPushWithFinishedCallBack(a,c,d,f,e)};c.registerPushWithFinishedCallBack=function(a,c,d,e,f){var g=this;f===void 0&&(f=!1);return new(b("Promise"))(function(b,h){g.$7(a,c,d,!1,e,f).then(function(a){if(typeof a!=="boolean"){h(new Error("registerPushImpl did not return a boolean"));return}b(a)})["catch"](h)})};c.$7=function(c,d,e,f,g,h){__p&&__p();var i=this;if(a.$1)return new(b("Promise"))(function(a,b){b(new Error("registering already"))});if(!self.PushManager)return b("Promise").reject(new Error("PushManager not found."));a.$1=!0;return new(b("Promise"))(function(j,k){__p&&__p();var l=b("ServiceWorkerRegistration").registerWorkerIfUnregistered(i.$3),m=i.$6();b("Promise").all([l,m]).then(function(l){__p&&__p();var m=l[0];if(!a.pushPermissionIsOn()){h&&m.unregister();throw new Error("Push permission was denied")}f||j(!0);l=b("BrowserPushPubKey").appServerKey;l=l!=null&&l!=""?{userVisibleOnly:!0,applicationServerKey:l}:{userVisibleOnly:!0};m.pushManager.subscribe(l).then(function(a){f&&j(b("PushRegistrationUtils").normalizeSubscriptionEndpoint(a)),i.$4(c,d,a,e),g&&g(),b("BrowserPushVisibilityChanger").listenForVisibility()})["catch"](function(b){a.$1=!1,h&&m.unregister(),k(b)})})["catch"](function(b){a.$1=!1,k(b)})})};c.unregisterPushAndSWOnKaiOS=function(a,c,d,e){var f=this;return new(b("Promise"))(function(b,g){f.$5(a,c,e).then(function(){d.unregisterPush(),b()})["catch"](g)})};c.unregisterPushAndSW=function(a,c){var d=this;return new(b("Promise"))(function(e,f){d.$5(a,c,!0).then(function(){b("promiseDone")(b("ServiceWorkerRegistration").unregisterControllingWorker(),e)})["catch"](f)})};c.unregisterPushOnly=function(a,c){var d=this;return new(b("Promise"))(function(b,e){d.getPushSubscription().then(function(f){f?f.unsubscribe().then(d.$5(a,c,!0)).then(function(){b(!0)})["catch"](e):e()})["catch"](e)})};a.pushPermissionIsPending=function(){return window.Notification&&window.Notification.permission==="default"};a.pushPermissionIsOn=function(){return window.Notification&&window.Notification.permission==="granted"};a.pushPermissionIsDenied=function(){return window.Notification&&window.Notification.permission==="denied"};return a}();e.exports=a}),null);
__d("XBrowserPushDisabledController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/push/disabled/",{})}),null);